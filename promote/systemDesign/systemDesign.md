# 系统设计

## 目的

为用户、利益相同者提供一个解决方案。可以：高性能、可扩展、可维护。

## 范围

- 性能
- 可靠
- 安全
- 可用
- 成本

## 框架图

```
    client                  server                              database
        |                       |                                   |
        |       req             |              req data             |
        | --------------------> | --------------------------------> |
        |                       |                                   |
        |                       |              res data             |
        | <-------------------- | <-------------------------------- |
        |                       |                                   |
```

### 竖直扩展

支持快速、容易为系统添加节点。

### 水平扩展

添加更多系统

- 减少宕机
- 提升性能

#### 负载均衡

## database

| 主从关系           | p2p                                          | multi-master replication |                        |
| ------------------ | -------------------------------------------- | ------------------------ | ---------------------- |
| 用于写数据         | 所有服务都可以读、写                         | 多个服务可以写数据       |                        |
| 多个服务执行读操作 | 需要复制数据                                 | 各数据库之间复制数据。   |                        |
|                    | 可以提高写操作多的性能                       |                          | 可以提高写操作多的性能 |
|                    |                                              |                          | 可扩展                 |
|                    | 主数据库写（插入、删除、更新），从数据库读。 |                          |                        |
|                    |                                              |                          |                        |
|                    |                                              |                          |                        |
|                    |                                              |                          |                        |

### 数据共享

### 选择数据库

- 性能
- 可扩展性
- 可访问性

### 关系型数据库

- mysql
- oracle
- microsoft sql server
- postgresql

### 非关系型数据库

- kv store
- graph store
- columns store
- document store

## cache 缓存

用于提高性能。  
把常用的数据放在临时空间中。

|                    | 用时                |     |
| ------------------ | ------------------- | --- |
| 从 ram 中读        | 10-100 nanoseconds  |     |
| 从 ssd 中读        | 50-100 microseconds |     |
| 从 hard drive 中读 | 5-10 milliseconds   |     |

### 简单的工作流

```

        server                  cache               database cluster(主从关系)
            |                     |                         |
            |    1. 在缓存中检查数据 |                         |
            | ------------------> |  1.2 缓存中是否存在相关数据 |
            |                     | ----------------------> |
            |                     |                         |
            |                     |  1.3 从数据库中返回数据，  |
            |                     |  更新缓存                |
            |                     | <---------------------- |
            |   1.4 返回数据给服务  |                         |
            | <------------------ |                         |
            |  2. 从缓存中返回数据   |                         |
            | <------------------ |                         |
            |                     |                         |
            | <------------------ | <---------------------- |
            |                     |                         |
            |                     |                         |
```

|                       |                                          |     |     |     |
| --------------------- | ---------------------------------------- | --- | --- | --- |
| cache size            | 大缓存会缓存更多数据，也会占用更多资源。 |     |     |     |
| cache eviction policy | lru / fifo                               |     |     |     |
| cache expiration      | 缓存时间                                 |     |     |     |
| cache consistency     | 缓存一致性                               |     |     |     |
| cache efficiency      | 缓存效率                                 |     |     |     |
| cache usage patterns  | 缓存                                     |     |     |     |

## content delivery network (cdn)

减少访问者与服务器的物理距离。提高性能。

```
        client1         client2             cdn         server
            |               |                 |             |
            |               |                 |             |
            |         请求 img.png             |             |
            | ------------------------------> |             |
            |               |                 |    请求      |
            |               |                 |    img.png  |
            |               |                 | ----------> |
            |               |                 |             |
            |               |                 |    回馈      |
            |               |                 |    img.png  |
            |         回馈 img.png             | <---------- |
            | <------------------------------ |             |
            |               |                 |             |
            |               |     请求         |             |
            |               |     img.png     |             |
            |               | --------------> |             |
            |               |                 |             |
            |               |     回馈         |             |
            |               |     img.png     |             |
            |               | <-------------- |             |
            |               |                 |             |
```

|                           |      |     |     |
| ------------------------- | ---- | --- | --- |
| cache expiration          |      |     |     |
| geographical distribution |      |     |     |
| cost                      | 价格 |     |     |
| integration               |      |     |     |
| security                  |      |     |     |

## queue

### title

### title

## loggin & monitoring

标记问题。  
提高可访问性。  
优化性能。

|                         |                                                  |     |     |
| ----------------------- | ------------------------------------------------ | --- | --- |
| 标记错误                |                                                  |     |     |
| 优化性能                |                                                  |     |     |
| 能力规划                | 扩展、收缩功能。添加、移除资源。提升硬件、软件。 |     |     |
| 服从目的                |                                                  |     |     |
| dubugging & development |                                                  |     |     |
| 警告                    |                                                  |     |     |

## title

## title
