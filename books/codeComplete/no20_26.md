代码改进

# no.20 软件质量概述

## 软件质量的特性

- 正确性
- 易用性
- 效率
- 可靠性
- 完整性
- 适应性
- 精确性
- 健壮性

有一部分是重叠的。质量的外部特性是用户关心的。
程序员关心内部质量特性：

- 可维护性
- 灵活性
- 可移植性
- 可重用性
- 可读性
- 可测试性
- 可理解性  
  内部特性与外部特性之间的差异不是泾渭分明的。  
  有时一个特性会损害另一个特性，有时一个特性会促进另一个特性。

|        | 正确性 | 易用性 | 效率 | 可靠性 | 完整性 | 适应性 | 精确性 | 健壮性 |
| ------ | ------ | ------ | ---- | ------ | ------ | ------ | ------ | ------ |
| 正确性 | -      |        | y    | y      |        |        | y      | n      |
| 易用性 |        | -      |      |        |        | y      | y      |        |
| 效率   | n      |        | -    | n      | n      | n      | n      |        |
| 可靠性 | y      |        |      | -      | y      |        | y      | n      |
| 完整性 |        |        | n    | y      | -      |        |        |        |
| 适应性 |        |        |      |        | n      | -      |        | y      |
| 精确性 | y      |        | n    | y      |        | n      | -      | n      |
| 健壮性 | n      | y      | n    | n      | n      | y      | n      | -      |

## 改进软件质量的技术

软件质量保证是一项需要预先计划的、系统性的活动，其目标是确保系统具有人们所期望的特性。

- 软件质量目标
- 明确的质量保证活动
- 测试策略
- 软件工程指南
- 非正式技术评审
- 正式技术评审
- 外部审计

开发过程

- 变更控制过程
- 结果的度量
- 制作原型

设置目标是实现高质量软件的一个简单、显而易见的步骤。它很容易被忽视。  
质量保证技术的相对效能  
找出缺陷的成本  
修正缺陷的成本

- 对所有需求、所有架构以及系统关键部分的设计进行正式审查
- 建模或创建原型
- 代码阅读或审查
- 执行测试

软件质量的普遍原理

- 提高生产率和改进质量的最佳方法是减少花费在代码返工上的时间，无论返回是由需求变化、设计变更还是调试引起的。（业界平均生产率大约每人每天 10-50 行最终交付代码）

# no.21 协同构建

就是多个程序员在一个写代码。目标是提高软件质量。  
协同构建：

- 结对编程
- 正式审查
- 非正式技术评审
- 文档阅读
- 集体所有制适用于所有形式的协同构建
- 在构建前后保持协作

## 结对编程

- 一个程序员在写代码
- 另一个程序员在观察是否有错误。思考是否代码是否正确以及这些代码是做了正确的事。
- 用编码规范支持结对编程
- 不要让结对编程变成旁观
- 不要强迫在简单的问题上使用结对编程
- 定期对结对人员和分配的工作任务进行轮换
- 鼓励双方跟上对方的步伐
- 确保双方都能看到显示器
- 不要强迫看不顺眼的人结对
- 避免新手组件
- 指定一个组长

好处

- 使人们在压力之下保持更好的状态
- 提升代码质量
- 缩短进度时间表

## 正式审查

在检测缺陷方面很有效。比测试省钱。

### 审查活动中的人员角色

不少于 3 人。

|        |                                                                                                                  |                                      |     |
| ------ | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------ | --- |
| 主持人 | 让审查以一定速度进行。保证会议有成效。尽可能找出最多错误。必须具备技术胜任力。可以不是专家，一定要了解相关细节。 |                                      |     |
| 作者   | 解释设计、代码中不清楚的部分                                                                                     |                                      |     |
| 审查员 | 找出缺陷                                                                                                         |                                      |     |
| 记录员 | 记录审查会议中发现的错误和行动项的分配情况                                                                       | 作者和主持人不能做记录员             |     |
| 管理者 |                                                                                                                  | 邀请管理者参加审核会议一般不是好主意 |     |

### 审查的步骤

|                  |                                                                                                                                                                                                                        |                                                                 |     |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- | --- |
| 规划             | 作者向主持人提交给主持人。主持人决定由谁审查该材料以及何时何地召开审查会议。                                                                                                                                           |                                                                 |     |
| 概述             | 作者说清创建设计或代码的技术环境。不超过 1h                                                                                                                                                                            | 此阶段可掩盖设计、代码中不清楚的地方。                          |     |
| 准备             | 每人独立审查                                                                                                                                                                                                           | 基于视角审查会发现更多错误。                                    |     |
| 审查会议         | 主持人选择非作者一人阐述设计或阅读代码。说清所有逻辑。陈述进程中记录员记录发现的错误。所有讨论在确认它确实是一个错误时停止。记录员记录错误的类型、严重程度。然后继续审查。若讨论过程未保持聚集，则主持人要收加到正轨。 | 开始：150-200r/h,系统级：90r/h,应用程序：500r/h。一般不过程 2h. |     |
| 审查报告         | 主持人整理会议记录，周知相关同事。                                                                                                                                                                                     | 一天内主持人出报告                                              |     |
| 返工             | 主持人分配给相关相事错误后。由对应的人员解决错误。                                                                                                                                                                     |                                                                 |     |
| 跟进             | - 重新审查。 - 审查部分。 - 修正后不审查。                                                                                                                                                                             |                                                                 |     |
| 第三个小时的会议 | 讨论大家感兴趣的问题的解决方案。                                                                                                                                                                                       |                                                                 |     |
| 对审查进行微调   |                                                                                                                                                                                                                        |                                                                 |     |

审查无固定清单。每个团队由人员组成不同，他们容易范的错误也不同，不容易范的错误也不同。审查清单应该由多次审查后沉淀下来。

### 走查

由 2+个人讨论设计或代码。
解决错误方面，审查更有效。
若每个人的正确率是 80%。则
2 人正确率为 1-(0.2)^2 = 0.96
3 1-(0.2)^3 = 0.992
1-(0.2)^x > 0.9999
x > 5

### 代码阅读

发现错误的效率
||||
|-|-|-|
|代码阅读|3.3 个/h|20%-60%的错误|
|测试|1.8 个/h||
4000 行为宜。  
90%的错误在准备审查会议时发现。10%在审查过程中发现。

依靠审查、走查、代码阅读可提高软件质量。
结对编程与审查基本等效。

# no.22 开发人员测试

测试的 4 个阶段

- 单元测试
- 组件测试
- 集成测试
- 回归测试（没算它）
- 系统测试

| 黑盒测试                         | 白盒测试                         |
| -------------------------------- | -------------------------------- |
| 无法获知所测试程序的内部工作原理 | 已了解所测试程序的内部工作原理。 |
| 避免编写该代码的相同盲点。       |                                  |
|                                  |                                  |

发现 bug 的数量：协同开发 > 测试。

- 测试的目标与开发的目标背道而驰。
- 测试无法证明软件中已无错误。
- 测试不能提高代码质量。测试结果是可衡量软件质量的指标。
- 要求测试者在心理上已经发现错误。

开发时间所占时间比
![图]()

开发人员的测试方法：

- 测试每个相关需求。
- 对每个相关的设计重点进行测试
- 为这些需求和设计添加详细的测试用例
- 列出一个错误检查清单

测试是先做还是后做？先写测试用例。

- 先后测试用例用时相同
- 先写测试用例可更早发现缺陷
- 可使程序员先考虑需求和设计
- 早暴露相关问题
- 会将写好的测试用例保留下来。  
  先写测试用例是过去十年中出现的最有用的软件实践之一。

开发人员的局限性：

- 开发人员采用“干净测试”
- 对测试覆盖率过于乐观
- 跳过复杂的测试覆盖类型

测试技巧：

- 非完整测试
- 结构化基础测试
  - 测试用例的数量： 从 1 开始，每遇到 if/while/repeat/for/and/or 加 1。每个 case 加 1，没有 default 加 1.
- 数据流测试
- 数据状态的组合
- 等价划分。一个测试用例代表一部分可能的输入数据。
- 错误猜测
- 边界分析
- 复合边界
- 不良数据的类别
- 良好数据的类别
- 使用便于进行手工检查的测试用例

典型错误

- 从错误最多的地方开始改。
- 80%的错误出现在项目 20%的类或子程序中。
- 项目 50%的错误出现在 5%的类中。
- 提高质量可以缩短开发周期降低开发成本。

错误分类

- 25.18% 结构性错误
- 22.44% 数据错误
- 16.19% 功能实施错误
- 9.88% 构建错误
- 8.98% 集成错误
- 8.12% 功能需求错误
- 2.76% 测试定义或测试执行错误
- 1.74% 系统、软件架构错误
- 4.71% 其他非特定类型错误

- 大多数错误的范围是相当有限的。
- 许多错误和代码构建无关，与相关领域的知识有关。
- 大多数代码构建错误都是程序员人为错误
- 令人惊讶的是，笔误（拼写错误）是问题的常见来源。
- 对程序员错误的研究中，对设计的误解是个老生常谈的主题。
- 大多数错误修复起来很容易。
- 度量自己组织的错误相关经验是个好主意。

![错误的比例]()

期望发现多少错误

- 业内经验是，1-25 个/1000 行。
- 内部测试阶段，10-20 个/1000 行。
- 净室开发，0.1-3 个/1000 行。
- tsp，0.6 个/1000 行。

- 写测试用例
- 用小项目测试
- 用工具测试
- 单独运行一个方法

测试数据生成器
覆盖率监测
数据记录器、日志  
符号调试器  
系统干扰器  
维护测试记录。让测试过程变得可重复之外，还需要对项目进行度量。
单次-》多次-》循环、递归
个性-》重复-》批处理 脚手架
具象-》抽象-》沉淀、分层 模板 有背景色画

个人测试记录。定性分析-》定量分析。
跟踪自己的测试记录，分析常犯的错误，在编写代码、测试代码、修正错误上所花的时间。

《编程珠玑》
《测试驱动开发》

# no.23 调试

# no.24 title

# no.25 title

# no.26 title
