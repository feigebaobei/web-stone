# no.10 变量使用中的常规问题

每个变量只有一个用途。  
尽可能缩短变量的存活时间。

|              |     |     |
| ------------ | --- | --- |
| 关闭隐匿声明 |     |     |
| 声明所有变量 |     |     |
| 遵循命名规范 |     |     |
| 检查变量名   |     |     |

## 变量初始化指南

|                                                            |                     |     |
| ---------------------------------------------------------- | ------------------- | --- |
| 有声明时初始化每个变量                                     |                     |     |
| 在靠近首次使用的地方初始化每个变量                         | 就近原则            |     |
| 在理想情况下，应在靠近首次使用变量的地方声明和定义每个变量 |                     |     |
| 尽量使用 final/const                                       | const 常量 let 变量 |     |
| 特别注意计数器和累加器                                     |                     |     |
| 在构造函数中初始化该类的成员数据                           |                     |     |
| 检查是否需要重新初始化                                     |                     |     |
| 使用编译器设置来自动初始化所有变量                         |                     |     |
| 利用编译器的警告信息                                       |                     |     |
| 检查输入参数的合法性                                       |                     |     |
| 使用内存访问检测工具来检查错误的指针                       |                     |     |

## 缩小作用域的一般原则

- 在循环之前立即初始化循环中使用的变量。
- 在使用变量前不为其赋值
- 把相关语句放在一起
- 把相关语句组拆分成单独的子程序
- 开始时严格限制可见性，若非必要，不宜扩大变量的作用域

# no.11 变量名称的威力

|                |                                                                                                                                            |     |     |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | --- | --- |
| 最优长度       | 9-16                                                                                                                                       |     |     |
| 总数           | count / total                                                                                                                              |     |     |
| 索引           | index                                                                                                                                      |     |     |
| 循环索引       | i j k u n                                                                                                                                  |     |     |
| 变量中的对仗词 | begin/end first/last locked/unlocked min/max next/previous old/new opend/closed visible/invisible source/target source/destination up/down |     |     |
| 状态变量的命名 |                                                                                                                                            |     |     |
| 临时变量的命名 | temp x t                                                                                                                                   |     |     |
| 布尔变量的命名 | done error found success ok                                                                                                                |     |     |
| 枚举类型的命名 |                                                                                                                                            |     |     |
| 常量的命名     | const final 大写                                                                                                                           |     |     |
| 最优长度       |                                                                                                                                            |     |     |
| 最优长度       |                                                                                                                                            |     |     |
| 最优长度       |                                                                                                                                            |     |     |
| 最优长度       |                                                                                                                                            |     |     |
| 最优长度       |                                                                                                                                            |     |     |

用户自定义类型缩写 udt

为什么要有规范

|                                |     |     |
| ------------------------------ | --- | --- |
| 让大家觉得更理所当然           |     |     |
| 有助于在新项目中更快地学习代码 |     |     |
| 减少全名的扩散                 |     |     |
| 弥补编程语言的不足             |     |     |
| 强调相关变量之间的关系         |     |     |

非正式的命名规范
||||
|-|-|-|
|区分变量名和子程序名|||
|区分类和对象|||
|标识全局变量|||
|标识成员变量|||
|标识类型定义|||
|标识具名常量|||
|标识枚举类型的元素|||

创建可读的短名称

|                                                                                                |     |     |
| ---------------------------------------------------------------------------------------------- | --- | --- |
| 使用标准的缩写                                                                                 |     |     |
| 去掉所有非前置元音                                                                             |     |     |
| 删除虚词                                                                                       |     |     |
| 使用每个单词的第一个或前几个字母                                                               |     |     |
| 在每个单词的第一、第二、第三个字母后持续截断，选择最合适的一个                                 |     |     |
| 保留每个单词的第一个和最后一个字母                                                             |     |     |
| 使用名字中每个重要单词，最多不越过三个                                                         |     |     |
| 删除无用的后缀 ing/ed/...                                                                      |     |     |
| 保留每个音节中最引人注意的发音                                                                 |     |     |
| 确保不改变变量的含义                                                                           |     |     |
| 反复使用这些技术，直到将每个变量名的长度缩减到 8-20 个字符之间，或者语言对变量名限制的字符数。 |     |     |

变量名称避坑指南

|                                        |                  |     |
| -------------------------------------- | ---------------- | --- |
| 避免使用误导性的命名和缩写             |                  |     |
| 避免使用含义相似的命名                 |                  |     |
| 避免使用含义不同但命名相似的变量       |                  |     |
| 避免使用发音相近的命名                 | wrap/rap queen/q |     |
| 避免在命名中使用数字                   |                  |     |
| 避免在名称中拼错单词                   |                  |     |
| 避免使用英语中常常拼错的单词           |                  |     |
| 避免使用多种自然语言                   |                  |     |
| 不要使用与变量所代表内容完全无关的名称 |                  |     |
| 避免在命名中包含容易混淆的字符         |                  |     |

# no.12 基本数据类型

如何使用这些基本数据类型

## 不使用魔法数字的好处

|                |     |     |
| -------------- | --- | --- |
| 代码修改更可靠 |     |     |
| 代码修改更容易 |     |     |
| 代码可读性好   |     |     |

|                      |                                                                                                                                                                                              |     |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| 一般的数字           | 不使用魔法数字的好处：代码修改更可靠、代码修改更容易、代码可读性好                                                                                                                           |     |
| 可以使用 0、1 硬编码 |                                                                                                                                                                                              |     |
| 预防除 0 错误        |                                                                                                                                                                                              |     |
| 使类型转换变得明显   | 使用强转化                                                                                                                                                                                   |     |
| 避免混合类型的比较   |                                                                                                                                                                                              |     |
| 留心编译器的警告     |                                                                                                                                                                                              |     |
| 整数                 | 检查溢出                                                                                                                                                                                     |     |
| 浮点型               | 避免对大水差别很大的数做加减运算，避免相等判断（请使用整数判断是否相等），预测舍入误差，检查语言和库对特定数据类型的支持，                                                                   |     |
| 字符、字符串         | 避免使用魔法字符、字符串，注意差一错误，语言是否支持 unicode，在项目早期决定支持国际化、本地化，若需要支持多种语言，请使用 unicode                                                           |     |
| 布尔                 | 记录程序细节，简化复杂的判断，若有必要，可创建自己的布尔类型，                                                                                                                               |     |
| 枚举类型             | 可提高可读性、可靠性、可维护性。检查无效值，定义第一项和最后一项，便于循环控制，**将枚举的第一个元素留做无效值**，精确定义第一个元素、最后一个元素的使用方式，谨防为枚举元素明确赋值的陷阱。 |     |
| 具名常量             |                                                                                                                                                                                              |     |
| 数组                 | 确保所有数组索引都在数组的边界范围内，将数组视为顺序结构。检查数组的边界点，检查多维数组的使用顺序是否正确，注意索引串扰，                                                                   |     |
| 创建自定义类型       |                                                                                                                                                                                              |     |

# no.13 不常见的数据类型

我不同意种标题（分类）。多不常见才算不常见。此描述使用集合无明确边界。

本章讲解了：

- 结构体
- 指针
- 全局数据

## 结构体

- 使用结构体澄清数据关系
- 可简化对数据块的操作
- 可简化参数列表
- 可减少维护

## 指针

- 很容易出错
- 使用技巧
  - 隔离子程序或类中的指针操作
  - 同时声明+定义指针
  - 在相同作用域层级上分配和释放指针
  - 在使用前先检查指针
  - 在使用前先检查指针所引用的变量
  - 使用 tag 检查损坏的内存
  - 只在删除变量是做一次标记字段的检查
  - 增加显式冗余
  - 使用更多的指针变量以提高清晰度
  - 分配一片紧急备用内存
  - 粉碎垃圾数据
  - 删除或释放指针后将其设置为空
  - 在删除变量前检查非法指针
  - 跟踪指针分配情况

## 全局数据

### 常见问题

- 修改全局数据
- 怪异别名问题
- 可重入代码问题
- 阻碍代码复用
- 不确定的初始化顺序问题
- 破坏了模块化和智力的可管理性

### 没必要，不用全局数据

- 使用访问器子程序替代全局数据（就是数据 store，单例模式）
  - 集中管理数据
  - 所有对变量的引用都被隔离
  - 自动获得信息隐藏的大部分好处
  - 很容易抽象数据类型

|     |     |     |
| --- | --- | --- |
|     |     |     |

|     |     |     |
| --- | --- | --- |
|     |     |     |

|     |     |     |
| --- | --- | --- |
|     |     |     |
