# hippy

| 技术    | 渲染方式            |     |
| ------- | ------------------- | --- |
| h5      | webview             |     |
| rn      | harmony+shandowtree |     |
| hippy   | native ui           |     |
| flutter | 自渲染引擎          |     |

## 功能

以 vue 开发为例。在 hippy 中调用 hippy-vue-next 对 vue 代码做映射，将 vdom 更新转换为原生 ui 指令，通过 bridge 下发给原生，由原生渲染器绘制。
兼容 dom/bom。
支持调用原生能力和原生性能。

## 核心原理

三线程架构

```
        js thread ---|
            |        |
      bridge|        |bridge
            V        |
        ui thread    |
            |        |
      bridge|    |---|
            V    V
        native thread

```

### js 线程

运行业务逻辑，组件生命周期、状态计算，事件处理。
脱离 ui 渲染职责，避免计算阻塞界面。
运行 vue/react 等框架。

### ui 渲染线程

平台主线程（android ui thread / ios main thread）
接收虚拟 dom 差异数据，执行界面绘制。
与 js 线程分离，即使复杂计算也能保持流畅帧率。

### 原生能力线程

负责耗时操作：网络请求、文件读写、传感器数据。
封装平台原生 api 为 js 可调用接口。
异步通信、避免阻塞主线程。

### bridge

异步消息传递枢纽。
支持请求-响应模式和 promise 化调用。
内置错误处理、超时控制，保证可靠性。
核心价值：保持 web 开发效率的同时，通过多线程并行处理获得原生性能，复杂业务场景下也能保持流畅交互。

## 不足

- 样式。
  - flex 布局出错。
  - 文本不换行。
  - 不支持 grid
  - 不支持 gap
  - img 必须设置 w/h
  - 跨端异常导致样式无法统一。
- 线程&时序问题。jsbridge cb 延迟。事件回调顺序不稳定。
- 无法解析 url，只能使用 src.
- 文本只有写在 span 标签内才能生效。
- 调试
  - js 断点无法看到真实的渲染树。
  - 必须使用真机调试。
  - ios debug 包必须通过 xcode 编译。
- 一套代码无法在多端运行。实际需要写多套业务逻辑；
  - sdk 回调参数格式不一致，参数名也可能不一致。
  - 同一事件，hippy 适配层在 android、ios 上方案不同。

## 总结

在 web 开发效率与原生性能之间找到了平衡点。核心价值在于：

- 架构创新：三线程分离+异步 bridge 通信。
- 开发体验：保留前端框架开发模式，降低学习成本。
- 性能表现：原生渲染突破 webview 限制。
- 扩展性：模块化设计支持业务定制化需求。

## 后记

它的竞品有 weex/rn/flutter/uniapp 等。它们的初衷都是写一套代码可以在多端运行。实际上都没有完全达到目标。
hippy 的作者把视图层与逻辑层分别在 2 个线程中处理。像这种处理方式有微信小程序等。而且这 2 个产品都是腾讯的产品，我怀疑是同一批人写的。
做 1 vs n 的产品本质是搞个适配器。这个适配器是用解析器模式写的。由一套代码生成多套适应特定环境的代码。
