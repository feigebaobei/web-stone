<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&DiacriticalGrave;axios&DiacriticalGrave;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="axios"><code>axios</code></h1>
<h2 id="overview">overview</h2>
<p>前端一种异步请求的方式。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>XMLHttpRequests</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>fetch</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>axios(promise)</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="feature">feature</h3>
<ul>
<li>从浏览器中发出 xhr</li>
<li>在 node.js 中发现 http 请求</li>
<li>支持 promise</li>
<li>支持打断请求和回馈</li>
<li>可转换 request 和 response data</li>
<li>可取消请求。（fetch 不可取消）</li>
</ul>
<h2 id="install">install</h2>
<p><code>npm i axios</code></p>
<h2 id="usage">usage</h2>
<pre><code class="language-js"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;axios&#x27;</span>).<span class="hljs-property">default</span>
axios.<span class="hljs-title function_">get</span>(url,
    <span class="hljs-attr">params</span>: {
        <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;value&#x27;</span>
    }
).<span class="hljs-title function_">then</span>(...).<span class="hljs-title function_">catch</span>(...)
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(url, {
        <span class="hljs-attr">key0</span>: <span class="hljs-string">&#x27;v0&#x27;</span>,
        <span class="hljs-attr">key1</span>: <span class="hljs-string">&#x27;v1&#x27;</span>
    })
}

<span class="hljs-comment">// 创建一个实例</span>
<span class="hljs-comment">// axios.create([config])</span>
<span class="hljs-keyword">let</span> instance = axios.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;http:www.xxx.com&#x27;</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&#x27;key&#x27;</span>: <span class="hljs-string">&#x27;value&#x27;</span>
    }
})
<span class="hljs-comment">// 实例的方法</span>
axios#<span class="hljs-title function_">request</span>(config)
axios#<span class="hljs-title function_">get</span>(url[, config])
axios#<span class="hljs-title function_">delete</span>(url[, config])
axios#<span class="hljs-title function_">head</span>(url[, config])
axios#<span class="hljs-title function_">options</span>(url[, config])
axios#<span class="hljs-title function_">post</span>(url[, data[, config]])
axios#<span class="hljs-title function_">put</span>(url[, data[, config]])
axios#<span class="hljs-title function_">patch</span>(url[, data[, config]])
axios#<span class="hljs-title function_">getUri</span>([config])
</code></pre>
<h2 id="configuration">configuration</h2>
<p>没有配置文件。有配置项</p>
<pre><code class="language-js"><span class="hljs-attr">config</span>: {
    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/user&#x27;</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-comment">// default</span>
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://xxx&#x27;</span>,
    <span class="hljs-attr">transformRequest</span>: [<span class="hljs-keyword">function</span> (<span class="hljs-params">data, headers</span>) {...}], <span class="hljs-comment">// 在&#x27;PUT&#x27;, &#x27;POST&#x27;, &#x27;PATCH&#x27; and &#x27;DELETE&#x27;时，发出请求前处理一次数据</span>
    <span class="hljs-attr">transformResponse</span>: [<span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) {...}],
    <span class="hljs-attr">header</span>: {<span class="hljs-string">&#x27;k&#x27;</span>: <span class="hljs-string">&#x27;v&#x27;</span>},
    <span class="hljs-attr">params</span>: {<span class="hljs-string">&#x27;k&#x27;</span>: <span class="hljs-string">&#x27;v&#x27;</span>}, <span class="hljs-comment">// 发出get请求时把参数拼接到url中。</span>
    <span class="hljs-attr">paramsSerializer</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) {...}, <span class="hljs-comment">// serializing 查询字符串</span>
    <span class="hljs-attr">data</span>: {<span class="hljs-string">&#x27;k&#x27;</span>: <span class="hljs-string">&#x27;v&#x27;</span>}, <span class="hljs-comment">// 发出&#x27;PUT&#x27;, &#x27;POST&#x27;, &#x27;DELETE , and &#x27;PATCH&#x27;请求时的参数</span>
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>, <span class="hljs-comment">// 超时时间</span>
    <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 跨域请求时是否带cookie</span>
    <span class="hljs-attr">adapter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) {...}, <span class="hljs-comment">// 需要学习</span>
    <span class="hljs-attr">auth</span>: {<span class="hljs-string">&#x27;k&#x27;</span>: <span class="hljs-string">&#x27;v&#x27;</span>}, <span class="hljs-comment">// 用于http的auth验证</span>
    <span class="hljs-attr">ressponseType</span>: <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-comment">// default</span>
    <span class="hljs-attr">responseEncoding</span>: <span class="hljs-string">&#x27;utf-8&#x27;</span>, <span class="hljs-comment">// default</span>
    <span class="hljs-attr">xsrfCookieName</span>: <span class="hljs-string">&#x27;XSRF-TOKEN&#x27;</span>, <span class="hljs-comment">// 不会</span>
    <span class="hljs-attr">xsrfHeaderName</span>: <span class="hljs-string">&#x27;X-XSRF-TOKEN&#x27;</span>, <span class="hljs-comment">// 不会</span>
    <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">progressEvent</span>) {...}, <span class="hljs-comment">// 只在浏览器中支持，控制上传进程的控制器</span>
    <span class="hljs-attr">onDownLoadProgress</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">progressEvent</span>) {...},
    <span class="hljs-attr">maxCoutentLength</span>: <span class="hljs-number">2000</span>, <span class="hljs-comment">// 返回的最大数据</span>
    <span class="hljs-attr">validateStatus</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">status</span>) {...},
    <span class="hljs-attr">maxRedirects</span>: <span class="hljs-number">21</span>, <span class="hljs-comment">// 最大重定向次数</span>
    <span class="hljs-attr">beforeRedirect</span>: <span class="hljs-function">(<span class="hljs-params">options, {headers}</span>) =&gt;</span> {...},
    <span class="hljs-attr">socketPath</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// default 不会</span>
    <span class="hljs-attr">httpAgent</span>: <span class="hljs-keyword">new</span> http.<span class="hljs-title class_">Agent</span>({<span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>}), <span class="hljs-comment">// 默认是浏览器的agent. 若在node.js中使用，一般用于模拟浏览器请求</span>
    <span class="hljs-attr">httsAgent</span>: <span class="hljs-keyword">new</span> http.<span class="hljs-title class_">Agent</span>({<span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>}),
    <span class="hljs-attr">proxy</span>: { <span class="hljs-comment">// 设置代理服务器</span>
        <span class="hljs-attr">protocol</span>: <span class="hljs-string">&#x27;https&#x27;</span>,
        <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,
        <span class="hljs-attr">port</span>: <span class="hljs-number">9000</span>,
        <span class="hljs-attr">auth</span>: {
        <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;mikeymike&#x27;</span>,
        <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;rapunz3l&#x27;</span>
        }
    },
    <span class="hljs-attr">cancelToken</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">CancelToken</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">cancel</span>) {
    }), <span class="hljs-comment">// 专用于取消请求的token</span>
    <span class="hljs-attr">signal</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>().<span class="hljs-property">signal</span>,
    <span class="hljs-attr">decompress</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// default</span>
    <span class="hljs-attr">insecureTHHPParser</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// default 不会</span>
    <span class="hljs-attr">transitional</span>: { <span class="hljs-comment">// 不会</span>
        <span class="hljs-attr">silentJSONParsing</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// default value for the current Axios version</span>
        <span class="hljs-comment">// try to parse the response string as JSON even if `responseType` is not &#x27;json&#x27;</span>
        <span class="hljs-attr">forcedJSONParsing</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// throw ETIMEDOUT error instead of generic ECONNABORTED on request timeouts</span>
        <span class="hljs-attr">clarifyTimeoutError</span>: <span class="hljs-literal">false</span>,
    },
    <span class="hljs-attr">env</span>: {
         <span class="hljs-title class_">FormData</span>: <span class="hljs-variable language_">window</span>?.<span class="hljs-property">FormData</span> || <span class="hljs-variable language_">global</span>?.<span class="hljs-property">FormData</span> <span class="hljs-comment">// 自动序列化为FormData对象的payload</span>
    },
}
</code></pre>
<h3 id="配置默认值">配置默认值</h3>
<pre><code>axios.default.baseURL = 'xxx'
axios.default.headers.common['Authorization'] = axios.default.baseURL = AUTH_TOKEN
</code></pre>
<h3 id="自定义实例的默认值">自定义实例的默认值</h3>
<pre><code>const instance = axios.create({
  baseURL: 'https://api.example.com'
});
// Alter defaults after instance has been created
instance.defaults.headers.common['Authorization'] = AUTH_TOKEN;
</code></pre>
<h2 id="api">api</h2>
<pre><code class="language-js"><span class="hljs-title function_">axios</span>({
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-comment">// 小写</span>
    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/user/1234&#x27;</span>,
    <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">k0</span>: <span class="hljs-string">&#x27;v0&#x27;</span>,
        <span class="hljs-attr">k1</span>: <span class="hljs-string">&#x27;v1&#x27;</span>,
    }
})
<span class="hljs-title function_">axios</span>(url[, config])
axios.<span class="hljs-title function_">request</span>(config)
axios.<span class="hljs-title function_">get</span>(url[, config])
axios.<span class="hljs-title function_">post</span>(url[, config])
axios.<span class="hljs-title function_">put</span>(url[, config])
axios.<span class="hljs-title function_">delete</span>(url[, config])
axios.<span class="hljs-title function_">head</span>(url[, config])
axios.<span class="hljs-title function_">options</span>(url[, config])
axios.<span class="hljs-title function_">patch</span>(url[, config])
</code></pre>
<h2 id="response-schema">response schema</h2>
<pre><code class="language-js">{
  <span class="hljs-attr">data</span>: {
  }
  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>
  <span class="hljs-attr">statusText</span>: <span class="hljs-string">&#x27;OK&#x27;</span>
  <span class="hljs-attr">headers</span>: {
  }
  <span class="hljs-attr">config</span>: {
  }
  <span class="hljs-attr">request</span>: {
  }
}
</code></pre>
<h2 id="interceptors">interceptors</h2>
<pre><code class="language-js">axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    ...
    <span class="hljs-keyword">return</span> config
}, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
})
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    ...
    <span class="hljs-keyword">return</span> config
}, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
})
<span class="hljs-comment">// 删除打断</span>
<span class="hljs-keyword">let</span> myInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">() =&gt;</span> {...})
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">eject</span>(myInterceptor)
<span class="hljs-comment">// 删除实例的打断也类似</span>
</code></pre>
<ul>
<li>每个 interceptor 都会执行</li>
<li>按定义顺序执行</li>
<li>只返回最后一个 interceptor 的结果</li>
<li>每个 interceptor 接收前一个的结果</li>
</ul>
<h2 id="cancellation">cancellation</h2>
<p>推荐<code>AbortController</code>.在 axios v0.22.0+ 支持。</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
axios.<span class="hljs-title function_">get</span>(...).<span class="hljs-title function_">then</span>(...)
<span class="hljs-title function_">controller</span>() <span class="hljs-comment">// 取消请求</span>
</code></pre>
<h2 id="使用-applicationx-www-form-urlencoded-格式">使用 application/x-www-form-urlencoded 格式</h2>
<p>有下面多种方法</p>
<h3 id="form-data">form data</h3>
<p>在 v0.27.0 后支持设置了<code>header.Content-Type: multipart/form-data</code>会，自动序列化为 FormData 对象。</p>
<pre><code>import axios from 'axios';
axios.post('https://httpbin.org/post', {x: 1}, {
  headers: {
    'Content-Type': 'multipart/form-data'
  }
}).then(({data})=&gt; console.log(data));
</code></pre>
<h3 id="browser">browser</h3>
<pre><code class="language-js"><span class="hljs-comment">// no.1</span>
<span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>()
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>)
axios.<span class="hljs-title function_">post</span>(url, params)

<span class="hljs-comment">// no.2</span>
<span class="hljs-keyword">const</span> qs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;qs&#x27;</span>)
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/foo&#x27;</span>, qs.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">bar</span>: <span class="hljs-number">123</span> }))

<span class="hljs-comment">// no.3</span>
<span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;qs&#x27;</span>
<span class="hljs-keyword">const</span> data = { <span class="hljs-attr">bar</span>: <span class="hljs-number">123</span> }
<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span> },
  <span class="hljs-attr">data</span>: qs.<span class="hljs-title function_">stringify</span>(data),
  url,
}
<span class="hljs-title function_">axios</span>(options)
</code></pre>
<h3 id="nodejs">node.js</h3>
<pre><code class="language-js"><span class="hljs-comment">// no.1</span>
<span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;querystring&#x27;</span>)
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;http://something.com/&#x27;</span>, querystring.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> }))

<span class="hljs-comment">// no.2</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>)
<span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> url.<span class="hljs-title class_">URLSearchParams</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> })
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;http://something.com/&#x27;</span>, params.<span class="hljs-title function_">toString</span>())
</code></pre>
<h2 id="principle">principle</h2>
<p>输出了多个东西。平时只使用了主要的。<br>
平时用不到。作者有使用文档中也没写如何使用已经输出的其他东西。都已经不使用了，为什么还输出呢？
<code>import defaults from './defaults/index.js';</code>是默认配置文件。使用了<code>*.js</code>，而非<code>*.json</code>。<br>
全项目使用js开发。非ts,在ts项目使用此包会有类型问题。<br>
<code>axios</code>是<code>Axios</code>的实例。
<code>axios.Axios = Axios;</code>外国人总喜欢使用这种环。可能是为了文件引用。<br>
打包工具： rollup/webpack</p>
<pre><code class="language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Axios</span> {
  <span class="hljs-title function_">constructor</span> (instanceConfig) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaults</span> = instanceConfig; <span class="hljs-comment">// 这里设置了默认配置项</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span> = {           <span class="hljs-comment">// 这是设置了打断器</span>
      <span class="hljs-attr">request</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterceptorManager</span>(),
      <span class="hljs-attr">response</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterceptorManager</span>()
    };
  }
  <span class="hljs-title function_">request</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 它是做什么的</span>
  <span class="hljs-comment">// 经过处理配置信息</span>
  <span class="hljs-comment">// 验证配置信息</span>
  <span class="hljs-comment">// 处理请求头</span>
  <span class="hljs-comment">// 把请求打断器和回馈打断器分别放在2个组件中。</span>
  <span class="hljs-comment">// 使用</span>
  <span class="hljs-title function_">getUri</span>(<span class="hljs-params"></span>) {}
}
</code></pre>
<p>很多功能、服务、方法都是在init时从类似配置文件中取出配置项再与程序员设计的配置项相结合，再初始化。</p>
<pre><code class="language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptorManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">helpers</span> = []
  }
  <span class="hljs-title function_">use</span>(<span class="hljs-params">fulfilled, rejected, options</span>) {} <span class="hljs-comment">// 挂载的。把数据添加helpers中。vue就是使用此方法挂载插件的。</span>
  <span class="hljs-comment">// 还有第三个参数。文档中也不说明它。</span>
  <span class="hljs-title function_">eject</span>(<span class="hljs-params">id</span>) {} <span class="hljs-comment">// 从hlepers中删除指定的数据</span>
  <span class="hljs-title function_">clear</span>(<span class="hljs-params"></span>) {}   <span class="hljs-comment">// 清空helpers</span>
  <span class="hljs-title function_">forEach</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 执行全部helpers中的数据、方法</span>
}
</code></pre>
<p><code>import AxiosError from '../core/AxiosError.js';</code>是封装的错误对象
作者封装了错误对象。错误信息中包括</p>
<pre><code class="language-js">message
name
stack
code
config
request
response
</code></pre>
<p>需要一个包括更多有关该信息在错误对象中。所以封装了该对象。我在我项目也可以这样做。<br>
又在原型链上。
<code>import validator from '../helpers/validator.js';</code>是验证文件。若验证出错，则使用封装的错误对象抛出错误。
<code>import CanceledError from '../cancel/CanceledError.js';</code>是基于AxiosError封装的取消请求时的错误
内部与AbortController对象结合使用。<br>
<code>import AxiosHeaders from '../core/AxiosHeaders.js';</code>是</p>
<pre><code class="language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AxiosHeaders</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">headers</span>) {
    headers &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(headers);
  }
  <span class="hljs-title function_">set</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 设置头后，返回this. 这是常用的链模式</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 返回头中的指定字段</span>
  <span class="hljs-title function_">has</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 返回是否存在指定头字段</span>
  <span class="hljs-title function_">delete</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 返回是否删除的指定头</span>
  <span class="hljs-title function_">clear</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// </span>
  <span class="hljs-title function_">normalize</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 序列化</span>
  <span class="hljs-title function_">concat</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// </span>
  <span class="hljs-title function_">toJSON</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 返回反序列化</span>
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {} <span class="hljs-comment">// 基于反序列化后使用</span>
  <span class="hljs-title function_">toString</span>(<span class="hljs-params"></span>) {} <span class="hljs-comment">// 序列化</span>
  get [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toStringTag</span>]() {} <span class="hljs-comment">// 覆盖原型方法</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">from</span> <span class="hljs-comment">// 是否是实例</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">concat</span>(first, ...targets) <span class="hljs-comment">// 添加头后返回实例</span>
  <span class="hljs-keyword">static</span> accessor <span class="hljs-comment">// 记录是否访问过。key是序列化后的header</span>
}
</code></pre>
<p><code>import adapters from &quot;../adapters/adapters.js&quot;;</code>中使用2个适配器：http/xhr<br>
使用映射表判断使用哪个适配器。<br>
最后返回指定的适配器，它是一个请求方法。
<code>import dispatchRequest from './dispatchRequest.js';</code>会触发请求。
使用正确的请求方法请求。
若请求数据成功，则经过转换数据后返回数据。否则返回经过转换数据后经过包装后返回数据。
全程使用promise处理。</p>
<p><code>import httpAdapter from './http.js';</code>
依赖http/https。使用该包请求。
可能使用了它们才使得axios可以在服务端使用。<br>
使用了自定义事件处理。</p>
<p><code>import xhrAdapter from './xhr.js';</code>
使用promise+xhr实现请求+链式调用。</p>
<h3 id="运行的顺序图">运行的顺序图。</h3>
<h3 id="目录结构">目录结构</h3>
<pre><code>&lt;root&gt;
|-- bin
|-- dist
|-- examples
|-- lib
    |-- core
    |-- axios.js
    |-- utils.js
    |-- lib
    |-- lib
    |-- lib
    |-- lib
    |-- lib
    |-- lib
|-- sandbox
|-- templates
|-- test
|-- index.js
|-- package.json
|-- readme.md
|-- rollup.config.js
|-- tsconfig.json
|-- webpack.config.js
|-- xxx
|-- xxx
</code></pre>
<p>是否可以use多个？</p>
<h3 id="uml">uml</h3>
<pre><code>
</code></pre>
<h2 id="demo">demo</h2>
<pre><code class="language-js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>
<span class="hljs-keyword">import</span> md5 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;md5&#x27;</span>
<span class="hljs-keyword">import</span> createSimpleStore <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./simpleStore&#x27;</span>

<span class="hljs-keyword">let</span> simpleStore = <span class="hljs-title function_">createSimpleStore</span>()

<span class="hljs-keyword">let</span> instance = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-comment">// baseURL: &#x27;http:www.xxx.com&#x27;,</span>
  <span class="hljs-comment">// 用于各种后端接口，所以不适合设置baseURL</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-comment">// &#x27;key&#x27;: &#x27;value&#x27;</span>
  },
})
<span class="hljs-keyword">let</span> myInterceptor = instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-comment">// 取消重复请求</span>
    <span class="hljs-keyword">let</span> hashStr = <span class="hljs-title function_">md5</span>({
      <span class="hljs-attr">url</span>: config.<span class="hljs-property">url</span>,
      <span class="hljs-attr">method</span>: config.<span class="hljs-property">method</span>,
      <span class="hljs-attr">params</span>: config.<span class="hljs-property">params</span>,
      <span class="hljs-attr">data</span>: config.<span class="hljs-property">data</span>,
    })
    <span class="hljs-keyword">if</span> (simpleStore.<span class="hljs-title function_">isExist</span>(hashStr)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> config
    }
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> hashStr = <span class="hljs-title function_">md5</span>({
      <span class="hljs-attr">url</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">url</span>,
      <span class="hljs-attr">method</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">method</span>,
      <span class="hljs-attr">params</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">params</span>,
      <span class="hljs-attr">data</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">data</span>,
    })
    simpleStore.<span class="hljs-title function_">remove</span>(hashStr)
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;请求出错&#x27;</span>))
    }
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)
<span class="hljs-comment">// let cancelRequest = () =&gt; {</span>
<span class="hljs-comment">//     axios.interceptors.request.eject(myInterceptor)</span>
<span class="hljs-comment">// }</span>

<span class="hljs-keyword">export</span> {
  instance,
  <span class="hljs-comment">// 强制取消请求</span>
  <span class="hljs-comment">// cancelRequest</span>
}
</code></pre>
<pre><code class="language-js"><span class="hljs-keyword">let</span> <span class="hljs-title function_">createSimpleStore</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">let</span> simpleStore = {
    <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
    <span class="hljs-attr">isExist</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
      <span class="hljs-keyword">return</span> simpleStore.<span class="hljs-property">value</span>.<span class="hljs-title function_">has</span>(v)
    },
    <span class="hljs-attr">add</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
      simpleStore.<span class="hljs-property">value</span>.<span class="hljs-title function_">add</span>(v)
    },
    <span class="hljs-attr">remove</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
      simpleStore.<span class="hljs-property">value</span>.<span class="hljs-title function_">delete</span>(v)
    },
  }
  <span class="hljs-keyword">return</span> simpleStore
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createSimpleStore
</code></pre>
<h2 id="todo">todo</h2>
<p>如使用promise实现的。
可以匿名的地方也使用具名函数编写。（如：回调函数）
如何使用简写。</p>

        
        
    </body>
    </html>