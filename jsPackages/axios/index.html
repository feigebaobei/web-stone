<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&DiacriticalGrave;axios&DiacriticalGrave;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="axios"><code>axios</code></h1>
<h2 id="overview">overview</h2>
<p>一种异步请求的方式。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>XMLHttpRequests</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>fetch</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>axios(promise+xhr/http(s))</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="feature">feature</h3>
<ul>
<li>从浏览器中发出 xhr</li>
<li>在 node.js 中发出 http(s) 请求</li>
<li>支持 promise</li>
<li>支持打断请求和回馈</li>
<li>可转换 request 和 response data</li>
<li>可取消请求。（fetch 不可取消）</li>
</ul>
<h2 id="install">install</h2>
<p><code>npm i axios</code></p>
<h2 id="usage">usage</h2>
<pre><code class="language-js"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;axios&#x27;</span>).<span class="hljs-property">default</span>
axios.<span class="hljs-title function_">get</span>(url,
    <span class="hljs-attr">params</span>: {
        <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;value&#x27;</span>
    }
).<span class="hljs-title function_">then</span>(...).<span class="hljs-title function_">catch</span>(...)
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(url, {
        <span class="hljs-attr">key0</span>: <span class="hljs-string">&#x27;v0&#x27;</span>,
        <span class="hljs-attr">key1</span>: <span class="hljs-string">&#x27;v1&#x27;</span>
    })
}

<span class="hljs-comment">// 执行多个请求</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserAccount</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/12345&#x27;</span>);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserPermissions</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user/12345/permissions&#x27;</span>);
}
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">getUserAccount</span>(), <span class="hljs-title function_">getUserPermissions</span>()])
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">results</span>) {
    <span class="hljs-keyword">const</span> acct = results[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> perm = results[<span class="hljs-number">1</span>];
  });

<span class="hljs-comment">// 创建一个实例</span>
<span class="hljs-comment">// axios.create([config])</span>
<span class="hljs-keyword">let</span> instance = axios.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;http:www.xxx.com&#x27;</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&#x27;key&#x27;</span>: <span class="hljs-string">&#x27;value&#x27;</span>
    }
})
<span class="hljs-comment">// 实例的方法</span>
axios#<span class="hljs-title function_">request</span>(config)
axios#<span class="hljs-title function_">get</span>(url[, config])
axios#<span class="hljs-title function_">delete</span>(url[, config])
axios#<span class="hljs-title function_">head</span>(url[, config])
axios#<span class="hljs-title function_">options</span>(url[, config])
axios#<span class="hljs-title function_">post</span>(url[, data[, config]])
axios#<span class="hljs-title function_">put</span>(url[, data[, config]])
axios#<span class="hljs-title function_">patch</span>(url[, data[, config]])
axios#<span class="hljs-title function_">getUri</span>([config])
</code></pre>
<p>支持用法：</p>
<ul>
<li>esm</li>
<li>cjs</li>
<li>script</li>
</ul>
<h2 id="configuration">configuration</h2>
<p>没有配置文件。有配置项</p>
<!-- prettier-ignore-start -->
<table>
<thead>
<tr>
<th>key</th>
<th>参数</th>
<th>子参数</th>
<th>description</th>
<th>type</th>
<th>default</th>
<th>enum</th>
<th>demo</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>method</td>
<td></td>
<td>请求方式</td>
<td>string</td>
<td>'get'</td>
<td>'get'/'post'/'put'/'delete'/'option'/...</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>baseUrl</td>
<td></td>
<td>当url是相对链接时url的前缀。作用于当前实例。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>transformRequest</td>
<td></td>
<td>当使用‘put’、‘post’、‘patch’、‘delete’请求时，改变请求数据。最后一个方法必须返回string/buffer/buffer[]/FormData/Stream。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Function[]</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>transformResponse</td>
<td></td>
<td>改变回馈数据，然后传递给then/catch</td>
<td>Function[]</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>headers</td>
<td></td>
<td>设置header</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>{'X-Request-With': 'XMLHttpRequest'}</td>
<td></td>
<td></td>
</tr>
<tr>
<td>params</td>
<td></td>
<td>设置qs</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>paramsSerializer</td>
<td></td>
<td>设置qs的序列化方法</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>{encode?: (params: string): string =&gt; {}, serialize?: (params: Record&lt;string, any&gt;, option?: ParamsSerializerOptions), indexes: false}</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>data</td>
<td></td>
<td>设置请求体。只作用于put/post/delete/patch</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>timeout</td>
<td></td>
<td>超时阈值</td>
<td></td>
<td>1000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>withCredentials</td>
<td></td>
<td>明确是否使用cross-site / Access-Control</td>
<td></td>
<td>false</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>adapter</td>
<td></td>
<td>自定义请求控制柄。可以方便测试。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>auth</td>
<td></td>
<td>设置<code>Authorization</code>字段（也可以在headers中设置）。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>responseType</td>
<td></td>
<td>回馈类型。</td>
<td></td>
<td>'blob'</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>responseEncoding</td>
<td></td>
<td>回馈的码类型</td>
<td></td>
<td>'utf8'</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>xsrfCookieName</td>
<td></td>
<td>xsrf的cookie名</td>
<td></td>
<td>'XSRF-TOKEN'</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>xsrfHeaderName</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>onUploadProgress</td>
<td></td>
<td>upload的进度控制柄</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>function({loaded, total, progress, bytes, emtimated, rate, upload = true}) {...}</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>onDownloadProgress</td>
<td></td>
<td>下载的进度控制柄</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>function({loaded, total, progress, bytes, estimated, rate, download = true}) {}</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>maxContentLength</td>
<td></td>
<td>回馈的最大体积。node.js时有效</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>maxBodyLength</td>
<td></td>
<td>只在node.js时有效。请求体的最大体积。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>validateStatus</td>
<td></td>
<td>有效的回馈码值</td>
<td></td>
<td><code>function (status) {return status &gt;= 200 &amp;&amp; status &lt; 300}</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>maxRedirects</td>
<td></td>
<td>最大可重定向次数。</td>
<td></td>
<td>21</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>beforeRedirect</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>socketPath</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>transport</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>httpAgent</td>
<td></td>
<td>http(s)的代理</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>httpsAgent</td>
<td></td>
<td>-</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>proxy</td>
<td><code>{protocal: 'https', host: '127.0.0.1', hostname: '127.0.0.1', port: 9000, auth: {username: 'name', password: 'pwd'}}</code></td>
<td>设置代理</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>cancelToken</td>
<td></td>
<td>可以用于取消请求</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>new CancelToken(function (cancel) {...})</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>signal</td>
<td></td>
<td>用于取消请求</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>new AbortController().signal</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>decompress</td>
<td></td>
<td>是否解压</td>
<td></td>
<td>true</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>insecureHTTPParser</td>
<td></td>
<td>不安全的http解析器</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>transitional</td>
<td><code>{silentJSONParsing: true, forcedJSONParsing: true, clarifyTimeoutError: false}</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>env</td>
<td></td>
<td>设置处理FormData的类</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>formSerializer</td>
<td><code>{visitor: (value, key, path, helpers) =&gt; {}, dots: boolean, metaTokens: boolean, indexes: boolean}</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>maxRate</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<!-- prettier-ignore-end -->
<h3 id="transformrequest--transformresponse--interceptionrequest--interceptionresponse">transformRequest &amp; transformResponse &amp; interception.request &amp; interception.response</h3>
<table>
<thead>
<tr>
<th>transformRequest</th>
<th>transformResponse</th>
<th>interception.request</th>
<th>interception.response</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>处理请求前的数据</td>
<td>处理回馈后的数据</td>
<td>处理请求时的配置项。处理请求成功和请求失败。</td>
<td>处理回馈后的数据。处理回馈成功和回馈失败。</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="配置默认值">配置默认值</h3>
<pre><code>axios.default.baseURL = 'xxx'
axios.default.headers.common['Authorization'] = axios.default.baseURL = AUTH_TOKEN
</code></pre>
<h3 id="自定义实例的默认值">自定义实例的默认值</h3>
<pre><code>const instance = axios.create({
  baseURL: 'https://api.example.com'
});
// Alter defaults after instance has been created
instance.defaults.headers.common['Authorization'] = AUTH_TOKEN;
</code></pre>
<h2 id="api">api</h2>
<pre><code class="language-js"><span class="hljs-title function_">axios</span>({
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-comment">// 小写</span>
    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/user/1234&#x27;</span>,
    <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">k0</span>: <span class="hljs-string">&#x27;v0&#x27;</span>,
        <span class="hljs-attr">k1</span>: <span class="hljs-string">&#x27;v1&#x27;</span>,
    }
})
<span class="hljs-comment">// 这里的配置项</span>
<span class="hljs-title function_">axios</span>(url[, config])
axios.<span class="hljs-title function_">request</span>(config)
axios.<span class="hljs-title function_">get</span>(url[, config])
axios.<span class="hljs-title function_">post</span>(url[, config])
axios.<span class="hljs-title function_">put</span>(url[, config])
axios.<span class="hljs-title function_">delete</span>(url[, config])
axios.<span class="hljs-title function_">head</span>(url[, config])
axios.<span class="hljs-title function_">options</span>(url[, config])
axios.<span class="hljs-title function_">patch</span>(url[, config])
</code></pre>
<h2 id="response-schema">response schema</h2>
<pre><code class="language-js">{
  <span class="hljs-attr">data</span>: {
  } <span class="hljs-comment">// 服务端回馈的数据</span>
  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span> <span class="hljs-comment">// http 码值</span>
  <span class="hljs-attr">statusText</span>: <span class="hljs-string">&#x27;OK&#x27;</span> <span class="hljs-comment">// http status message</span>
  <span class="hljs-attr">headers</span>: {
  } <span class="hljs-comment">// 服务端给的回馈头的</span>
  <span class="hljs-attr">config</span>: {
  } <span class="hljs-comment">// 本次请求的的配置项</span>
  <span class="hljs-attr">request</span>: {
  } <span class="hljs-comment">// response的请求</span>
}
</code></pre>
<h2 id="interceptors">interceptors</h2>
<pre><code class="language-js">axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    ...
    <span class="hljs-keyword">return</span> config
}, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
})
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    ...
    <span class="hljs-keyword">return</span> config
}, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
})
<span class="hljs-comment">// 删除打断</span>
<span class="hljs-keyword">let</span> myInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">() =&gt;</span> {...})
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">eject</span>(myInterceptor)
<span class="hljs-comment">// 删除实例的打断也类似</span>
</code></pre>
<ul>
<li>每个 interceptor 都会执行</li>
<li>按定义顺序执行</li>
<li>只返回最后一个 interceptor 的结果</li>
<li>每个 interceptor 接收前一个的结果</li>
</ul>
<h2 id="cancellation">cancellation</h2>
<p>推荐<code>AbortController</code>.在 axios v0.22.0+ 支持。</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
axios.<span class="hljs-title function_">get</span>(...).<span class="hljs-title function_">then</span>(...)
<span class="hljs-title function_">controller</span>() <span class="hljs-comment">// 取消请求</span>
</code></pre>
<h2 id="使用-applicationx-www-form-urlencoded-格式">使用 application/x-www-form-urlencoded 格式</h2>
<p>有下面多种方法</p>
<h3 id="form-data">form data</h3>
<p>在 v0.27.0 后支持设置了<code>header.Content-Type: multipart/form-data</code>会，自动序列化为 FormData 对象。</p>
<pre><code class="language-js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>;
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;https://httpbin.org/post&#x27;</span>, {<span class="hljs-attr">x</span>: <span class="hljs-number">1</span>}, {
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;multipart/form-data&#x27;</span>
  }
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{data}</span>)=&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));
</code></pre>
<h3 id="browser">browser</h3>
<pre><code class="language-js"><span class="hljs-comment">// no.1</span>
<span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>()
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>)
axios.<span class="hljs-title function_">post</span>(url, params)

<span class="hljs-comment">// no.2</span>
<span class="hljs-keyword">const</span> qs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;qs&#x27;</span>)
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/foo&#x27;</span>, qs.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">bar</span>: <span class="hljs-number">123</span> }))

<span class="hljs-comment">// no.3</span>
<span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;qs&#x27;</span>
<span class="hljs-keyword">const</span> data = { <span class="hljs-attr">bar</span>: <span class="hljs-number">123</span> }
<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span> },
  <span class="hljs-attr">data</span>: qs.<span class="hljs-title function_">stringify</span>(data),
  url,
}
<span class="hljs-title function_">axios</span>(options)
</code></pre>
<h3 id="nodejs">node.js</h3>
<pre><code class="language-js"><span class="hljs-comment">// no.1</span>
<span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;querystring&#x27;</span>)
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;http://something.com/&#x27;</span>, querystring.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> }))

<span class="hljs-comment">// no.2</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>)
<span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> url.<span class="hljs-title class_">URLSearchParams</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span> })
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;http://something.com/&#x27;</span>, params.<span class="hljs-title function_">toString</span>())
</code></pre>
<h2 id="principle"><a href="/jsPackages/axios/principle.html">principle</a></h2>
<h2 id="demo">demo</h2>
<pre><code class="language-js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>
<span class="hljs-keyword">import</span> md5 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;md5&#x27;</span>
<span class="hljs-keyword">import</span> createSimpleStore <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./simpleStore&#x27;</span>

<span class="hljs-keyword">let</span> simpleStore = <span class="hljs-title function_">createSimpleStore</span>()

<span class="hljs-keyword">let</span> instance = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-comment">// baseURL: &#x27;http:www.xxx.com&#x27;,</span>
  <span class="hljs-comment">// 用于各种后端接口，所以不适合设置baseURL</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-comment">// &#x27;key&#x27;: &#x27;value&#x27;</span>
  },
})
<span class="hljs-keyword">let</span> myInterceptor = instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-comment">// 取消重复请求</span>
    <span class="hljs-keyword">let</span> hashStr = <span class="hljs-title function_">md5</span>({
      <span class="hljs-attr">url</span>: config.<span class="hljs-property">url</span>,
      <span class="hljs-attr">method</span>: config.<span class="hljs-property">method</span>,
      <span class="hljs-attr">params</span>: config.<span class="hljs-property">params</span>,
      <span class="hljs-attr">data</span>: config.<span class="hljs-property">data</span>,
    })
    <span class="hljs-keyword">if</span> (simpleStore.<span class="hljs-title function_">isExist</span>(hashStr)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> config
    }
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> hashStr = <span class="hljs-title function_">md5</span>({
      <span class="hljs-attr">url</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">url</span>,
      <span class="hljs-attr">method</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">method</span>,
      <span class="hljs-attr">params</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">params</span>,
      <span class="hljs-attr">data</span>: res.<span class="hljs-property">config</span>.<span class="hljs-property">data</span>,
    })
    simpleStore.<span class="hljs-title function_">remove</span>(hashStr)
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;请求出错&#x27;</span>))
    }
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)
<span class="hljs-comment">// let cancelRequest = () =&gt; {</span>
<span class="hljs-comment">//     axios.interceptors.request.eject(myInterceptor)</span>
<span class="hljs-comment">// }</span>

<span class="hljs-keyword">export</span> {
  instance,
  <span class="hljs-comment">// 强制取消请求</span>
  <span class="hljs-comment">// cancelRequest</span>
}
</code></pre>
<pre><code class="language-js"><span class="hljs-keyword">let</span> <span class="hljs-title function_">createSimpleStore</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">let</span> simpleStore = {
    <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
    <span class="hljs-attr">isExist</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
      <span class="hljs-keyword">return</span> simpleStore.<span class="hljs-property">value</span>.<span class="hljs-title function_">has</span>(v)
    },
    <span class="hljs-attr">add</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
      simpleStore.<span class="hljs-property">value</span>.<span class="hljs-title function_">add</span>(v)
    },
    <span class="hljs-attr">remove</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
      simpleStore.<span class="hljs-property">value</span>.<span class="hljs-title function_">delete</span>(v)
    },
  }
  <span class="hljs-keyword">return</span> simpleStore
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createSimpleStore
</code></pre>
<h2 id="tsaxios"><a href="/jsPackages/axios/ts_axios.html">ts+axios</a></h2>
<h2 id="读源码"><a href="/jsPackages/axios/readCode.html">读源码</a></h2>
<h2 id="todo">todo</h2>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>如何实现特定功能的。</td>
<td>在别名方法中复用指定方法</td>
<td></td>
</tr>
<tr>
<td>如使用 promise 实现的。</td>
<td>在 request()方法体中使用<code>Promise</code>对象包装。</td>
<td></td>
</tr>
<tr>
<td>如何实现简写（别名）的</td>
<td>直接定义</td>
<td></td>
</tr>
<tr>
<td>可以匿名的地方也使用具名函数编写。（如：回调函数）</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>文件结构</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>uml.</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>类图</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>有多个地方把 get 与别的请求方式分开对待。</td>
<td>-</td>
<td></td>
</tr>
</tbody>
</table>

        
        
    </body>
    </html>