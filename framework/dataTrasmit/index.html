<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&#x7ec4;&#x4ef6;&#x95f4;&#x6570;&#x636e;&#x4f20;&#x9012;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension ms-toolsai.jupyter */
/* These classnames are inherited from bootstrap, but are present in most notebook renderers */

.alert {
    width: auto;
    padding: 1em;
    margin-top: 1em;
    margin-bottom: 1em;
}
.alert > *:last-child {
    margin-bottom: 0;
}
#preview > .alert:last-child {
    /* Prevent this being set to zero by the default notebook stylesheet */
    padding-bottom: 1em;
}

.alert-success {
    /* Note there is no suitable color available, so we just copy "info" */
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-info {
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-warning {
    background-color: var(--theme-warning-background);
    color: var(--theme-warning-foreground);
}
.alert-danger {
    background-color: var(--theme-error-background);
    color: var(--theme-error-foreground);
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="组件间数据传递">组件间数据传递</h1>
<ul>
<li>props + event</li>
<li>context</li>
<li>useSyncExternalStore</li>
</ul>
<h2 id="props--event">props + event</h2>
<h2 id="context">context</h2>
<h2 id="usesyncexternalstore">useSyncExternalStore</h2>
<p>基本用法<br>
demo0</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">useSyncExternalStore</span>(store.<span class="hljs-property">subscribe</span>, store,getSnapshot)
<span class="hljs-keyword">const</span> selectedField = <span class="hljs-title function_">useSyncExternalStore</span>(store.<span class="hljs-property">subscribe</span>, <span class="hljs-function">() =&gt;</span> store.<span class="hljs-title function_">getSnapshot</span>().<span class="hljs-property">selectedField</span>)
</code></pre>
<p>与一个store结合使用
demo1</p>
<pre><code class="language-js"><span class="hljs-comment">// 创建store</span>
<span class="hljs-keyword">const</span> store = {
    <span class="hljs-attr">state</span>: {
        <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;str&#x27;</span>,
        <span class="hljs-attr">k</span>: []
    },
    <span class="hljs-attr">listeners</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
    setState = <span class="hljs-function">(<span class="hljs-params">fnOrState</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> newState = <span class="hljs-keyword">typeof</span> fnOrState === <span class="hljs-string">&#x27;function&#x27;</span> ? <span class="hljs-title function_">fnOrState</span>(store.<span class="hljs-property">state</span>) : fnOrState
        store.<span class="hljs-property">state</span> = {
            ...store.<span class="hljs-property">state</span>,
            ...newState
        }
        store.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {<span class="hljs-title function_">listener</span>()})
    },
    <span class="hljs-attr">subscribe</span>: <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> {
        store.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">add</span>(cb)
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            store.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">delete</span>(cb)
        }
    },
    <span class="hljs-attr">getSnapshot</span>: <span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">state</span>
}

<span class="hljs-comment">// xxx</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">let</span> state = <span class="hljs-title function_">useSyncExternalStore</span>(store.<span class="hljs-property">subscribe</span>, store.<span class="hljs-property">getSnapshot</span>)
    <span class="hljs-keyword">return</span> (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {store.setState({count: state.count+1})}}&gt;state.count<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>)
}
</code></pre>
<p>与多个store结合使用。
demo2</p>
<pre><code class="language-js"><span class="hljs-comment">// createStore.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createStore</span> = (<span class="hljs-params">initState</span>) =&gt; {
    <span class="hljs-keyword">let</span> state = initState <span class="hljs-comment">// 这里应该使用深复制</span>
    <span class="hljs-keyword">let</span> listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    <span class="hljs-keyword">let</span> <span class="hljs-title function_">getSnapshot</span> = (<span class="hljs-params"></span>) =&gt; state
    <span class="hljs-keyword">let</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">fnOrState</span>) =&gt; {
        <span class="hljs-keyword">let</span> newState = <span class="hljs-keyword">typeof</span> fnOrState === <span class="hljs-string">&#x27;function&#x27;</span> ? <span class="hljs-title function_">fnOrState</span>(state) : fnOrState
        state = {
            ...state,
            ...newState
        }
        listener.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>())
    }
    <span class="hljs-keyword">let</span> subscribe = (<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {
        listener.<span class="hljs-title function_">add</span>(listener)
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            listeners.<span class="hljs-title function_">delete</span>(listener)
        }
    })
    <span class="hljs-keyword">return</span> {
        getSnapshot,
        setState,
        subscribe
    }
}

<span class="hljs-comment">// useMyStore.js</span>
<span class="hljs-keyword">import</span> createStore <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./createStore.js&#x27;</span>
<span class="hljs-keyword">const</span> initState = {
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;str&#x27;</span>
}
<span class="hljs-keyword">let</span> store = <span class="hljs-title function_">createStore</span>(initState)
<span class="hljs-keyword">let</span> <span class="hljs-title function_">loop</span> = v =&gt; (v)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useMyStore</span>(<span class="hljs-params">selector = loop</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">useSyncExternalStore</span>(store.<span class="hljs-property">subscribe</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(store.<span class="hljs-title function_">getSnapshot</span>())) <span class="hljs-comment">// 它是state</span>
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> {setState} = store

<span class="hljs-comment">// xxx</span>
<span class="hljs-keyword">import</span> useMyStore, {setState} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./useMyStore.js&#x27;</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">let</span> state = <span class="hljs-title function_">useMyStore</span>()
    <span class="hljs-keyword">return</span> (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {setState({count: 2})}}&gt;str<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>)
}
</code></pre>
<p>与React.reducer结合使用
demo3</p>
<pre><code class="language-js"><span class="hljs-comment">// createReducerStore.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">let</span> <span class="hljs-title function_">createReducerStore</span> = (<span class="hljs-params">reducer, initState</span>) =&gt; {
    <span class="hljs-keyword">let</span> state = initState
    <span class="hljs-keyword">let</span> listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    <span class="hljs-keyword">let</span> <span class="hljs-title function_">getSnapshot</span> = (<span class="hljs-params"></span>) =&gt; state
    <span class="hljs-keyword">let</span> <span class="hljs-title function_">dispatch</span> = action =&gt; {
        state = <span class="hljs-title function_">reducer</span>(state, action)
        listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>())
    }
    <span class="hljs-keyword">let</span> <span class="hljs-title function_">subscribe</span> = (<span class="hljs-params">listener</span>) =&gt; {
        listener.<span class="hljs-title function_">add</span>(listener)
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            listeners.<span class="hljs-title function_">delete</span>(listener)
        }
    }
    <span class="hljs-keyword">return</span> {
        getSnapshot,
        dispatch,
        subscribe
    }
}

<span class="hljs-comment">// useReducerStore</span>
<span class="hljs-keyword">import</span> createReducerStore <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./createReducerStore&#x27;</span>
<span class="hljs-keyword">let</span> initState = {...}
<span class="hljs-keyword">let</span> <span class="hljs-title function_">reducer</span> = (<span class="hljs-params">state, action</span>) =&gt; {
    <span class="hljs-keyword">let</span> res = state
    <span class="hljs-keyword">switch</span> (action) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:
            res = {
                ...state,
                <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>
            }
    }
    <span class="hljs-keyword">return</span> res
}

<span class="hljs-comment">// useReducerStore.js</span>
<span class="hljs-keyword">let</span> store = <span class="hljs-title function_">createReducerStore</span>(reducer, initState)
<span class="hljs-keyword">let</span> <span class="hljs-title function_">loop</span> = v =&gt; (v)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTodoStore</span>(<span class="hljs-params">(selector = loop) =&gt; {
    <span class="hljs-keyword">return</span> useSyncExternalStore(store.subscribe, () =&gt; selector(store.getSnapshot()))
}</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> {dispatch} = store

<span class="hljs-comment">// </span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">let</span> state = <span class="hljs-title function_">useReducerStore</span>()
    <span class="hljs-keyword">return</span> (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch({type: &#x27;x&#x27;})}&gt;str<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>)
}
</code></pre>
<h2 id="react">react</h2>
<h2 id="vue">vue</h2>
<h2 id="angular">angular</h2>
<h2 id="title">title</h2>
<h2 id="title">title</h2>
<h2 id="title">title</h2>

        
        
    </body>
    </html>