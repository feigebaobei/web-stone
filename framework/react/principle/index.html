<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&#x539f;&#x7406;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension vscode.markdown-math */
@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.16.2"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}

/* From extension ms-toolsai.jupyter */
/* These classnames are inherited from bootstrap, but are present in most notebook renderers */

.alert {
    width: auto;
    padding: 1em;
    margin-top: 1em;
    margin-bottom: 1em;
}
.alert > *:last-child {
    margin-bottom: 0;
}
#preview > .alert:last-child {
    /* Prevent this being set to zero by the default notebook stylesheet */
    padding-bottom: 1em;
}

.alert-success {
    /* Note there is no suitable color available, so we just copy "info" */
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-info {
    background-color: var(--theme-info-background);
    color: var(--theme-info-foreground);
}
.alert-warning {
    background-color: var(--theme-warning-background);
    color: var(--theme-warning-foreground);
}
.alert-danger {
    background-color: var(--theme-error-background);
    color: var(--theme-error-foreground);
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="原理">原理</h1>
<p>把 react / react-dom 的原理合并到这个文档中。<br>
<strong>不必学习 react 的每一个细节。我们需要知道它的关键部分。</strong></p>
<h2 id="react-到底做了什么">react 到底做了什么</h2>
<h3 id="核心概念">核心概念</h3>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>recenciliation</td>
<td>调度器，用于处理 diff、更新视图</td>
<td></td>
</tr>
<tr>
<td></td>
<td>root.render(...)</td>
<td>开始渲染视图</td>
<td></td>
</tr>
<tr>
<td></td>
<td>virtual dom</td>
<td>虚拟 dom</td>
<td></td>
</tr>
<tr>
<td></td>
<td>diffing algorithm</td>
<td>diff 算法。通过比较 current/workInProgress,得到最小变动.</td>
<td></td>
</tr>
<tr>
<td></td>
<td>mvc 框架</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>双缓存</td>
<td>current 表示当前展示的 vdom 树。workInProgress 表示本次更新后的 vdom 树。</td>
<td></td>
</tr>
<tr>
<td></td>
<td>fiber</td>
<td>工作单元。根据 ReactElement 元素生成。</td>
<td></td>
</tr>
<tr>
<td></td>
<td>ReactElement</td>
<td>使用 React.createElement 方法生成</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="react-component--react-element--component-instance">React Component &amp; React Element &amp; Component instance</h3>
<table>
<thead>
<tr>
<th></th>
<th>React Component</th>
<th>React Element</th>
<th>Component instance</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>组件。方法或 class</td>
<td>一个基本核心对象</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>返回 jsx/ReactElement</td>
<td></td>
<td>class 组件的实例。它是一个对象。</td>
<td></td>
</tr>
<tr>
<td></td>
<td>方法组件，直接调用。class 组件，创建一个实例后调用 render 方法。</td>
<td>可描述一个 dom.也可以描述一个 component instance</td>
<td>有生命周期方法和初始化 state</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>在 class 组件时期用处大</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="渲染过程">渲染过程</h3>
<ol>
<li>执行 class 组件的 render 方法或执行方法式组件，生成 Virtual DOM，它保存在内存中。</li>
<li>同步 vdom 到 real dom。初始化时全部插入。</li>
<li>当组件改变时生成新 vdom</li>
<li>比对 2 个 vdom 的不同。再更新 dom
<ol>
<li>使用 diff 算法比对。也叫 recencilication</li>
</ol>
</li>
<li></li>
</ol>
<h3 id="recenciliation">recenciliation</h3>
<ul>
<li>若 ReactElement 的 type 不同，则使用新组件及其后代元素。
<ul>
<li>会触发 unmount 生命周期方法</li>
</ul>
</li>
<li>属性不同时。更新属性，实例不变，状态不变。</li>
<li>使用 key props 比对。</li>
</ul>
<h3 id="diff-算法">diff 算法</h3>
<p>基于 2 个前提工作：</p>
<ul>
<li>type 不同表示不同的元素。</li>
<li>各子元素的 key 惟一。</li>
</ul>
<ol>
<li>type 不同时更新他与他的后代元素。</li>
<li>当 type 相同、属性不同时，更新当前元素，保留其他后代元素。</li>
<li>子元素使用 key 做对应关系</li>
</ol>
<h4 id="2-个阶段">2 个阶段</h4>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>render</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>commit</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="what-is-react-fiber">what is react fiber</h2>
<ul>
<li>它是一个对象</li>
<li>react reconciler 基于它工作。（它是异步的）它是工作单元</li>
<li>多个 fiber 对象组成树</li>
</ul>
<h3 id="目的">目的</h3>
<ul>
<li>动画</li>
<li>回应速度</li>
</ul>
<h3 id="功能">功能</h3>
<ul>
<li>可把工作分块，设置任务优先级。</li>
<li>停止或再继续工作。</li>
<li>重新工作或打断工作。</li>
</ul>
<h3 id="old-reconciler-fiber-出现前">old reconciler (fiber 出现前)</h3>
<ul>
<li>任务是同步的。</li>
<li>工作就像栈。</li>
<li>栈空了才能停止工作。</li>
</ul>
<h3 id="new-reconciler-fiber-出现后">new reconciler (fiber 出现后)</h3>
<ul>
<li>它是一个工作单元</li>
<li>当工作完成时 react process 把工作结果提交。生成新 dom</li>
</ul>
<h3 id="二个阶段">二个阶段</h3>
<ul>
<li>render phase (processing)
<ul>
<li>异步</li>
<li>定义任务的优先级，工作可能停止（可以被打断）、丢弃。</li>
<li>开始的方法，如：beginWork() / copmleteWork()</li>
</ul>
</li>
<li>commit phase (committing)
<ul>
<li>从 commitWork()开始</li>
<li>同步</li>
</ul>
</li>
</ul>
<h3 id="fiber-的属性">fiber 的属性</h3>
<ul>
<li>总是 1-1 的关系
<ul>
<li>1 个 fiber 对应一个组件/dom/...</li>
</ul>
</li>
<li>type 属性表示 tag
<ul>
<li>一共有 0-24。 有几个重要的。如下</li>
<li>FunctionComponent 0</li>
<li>ClassComponent 1</li>
<li>HostComponent 5 div/p/...</li>
<li>Fragment 7</li>
<li>ContextConsumer 9</li>
<li>ContextProvider 10</li>
</ul>
</li>
<li>stateNode 引用</li>
<li>child 第一个子元素</li>
<li>sibling 下一个同级元素</li>
<li>return 父元素</li>
</ul>
<h3 id="fiber--reactelement">Fiber &amp; ReactElement</h3>
<table>
<thead>
<tr>
<th></th>
<th>ReactElement</th>
<th>FiberNode</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>由 jsx 代码生成</td>
<td>由 ReactElement 对象生成</td>
<td></td>
</tr>
<tr>
<td></td>
<td>从 jsx 代码中得到 type/key</td>
<td>从 ReactElement 中取 type/key</td>
<td></td>
</tr>
<tr>
<td></td>
<td>由 jsx 代码生成</td>
<td>createFiberFromElement / createFiberFromTypeAndProps / createFiber 等</td>
<td></td>
</tr>
<tr>
<td></td>
<td>这是 vdom,代表一个 dom</td>
<td>工作的单元</td>
<td></td>
</tr>
<tr>
<td>功能</td>
<td></td>
<td>1. 寻迹。 2. 暂停。 3. 制定时间表</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>一直使用。若有变动，则修改属性。不销毁。通常在初次挂载时创建</td>
<td>修改是在 FiberNode 的替补节点上完成的。</td>
</tr>
<tr>
<td>如何 ReactElement =&gt; FiberNode</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code class="language-js"><div><span class="hljs-comment">// 常见的创建fiber的方法</span>
createFiberFromElement()
createFiberFromFragment()
createFiberFromText()
</div></code></pre>
<table>
<thead>
<tr>
<th></th>
<th>current</th>
<th>workInProgress</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>第一次生成的 FiberNode 组成的树和每次更新后生成的树</td>
<td>Fiber 在工作中生成的树</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>可以影响未来的状态和刷新屏幕</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>fiber 的所有工作都是从此树开始</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>由 class 组件的 render 方法返回的或方法组件返回的 ReactElement 创建</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>完成工作后此树被赋于 current</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>处理所有组件的进程、刷新屏幕。</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>每个节点的 alternate 指向另一棵树（current/workInProgress）上对应的节点</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>副作用（side-effects）： 每次活动（如：改变 dom）和调用生命周期方法
Fiber 的 Effecttag 属性是副作用函数
副作用 tag
Current 就是 fiberroot</p>
<p>FiberRootNode 下的第一个 FiberNode 是使用 FiberRootNode()创建的。</p>
<h3 id="fiber-如何工作">fiber 如何工作</h3>
<ul>
<li>state change</li>
<li>触发生命周期方法</li>
<li>dom 改变</li>
<li>生成时间表</li>
<li>可分割工作为多块</li>
<li>分高优、低优处理
<ul>
<li>高优 requestAnimationFrame()</li>
<li>低优 requestIdleCallback()</li>
</ul>
</li>
</ul>
<pre><code><code><div>    a1
    |
    b1 -- b2 -- b3
          |
          c1
          |
          c2
</div></code></code></pre>
<p><a href="https://vimeo.com/302222454">https://vimeo.com/302222454</a></p>
<ol>
<li>从 beginWork() 开始</li>
<li>一直处于此步骤</li>
<li>到 comleteWork() 结束</li>
</ol>
<h3 id="fiber-tree">fiber tree</h3>
<table>
<thead>
<tr>
<th></th>
<th>current</th>
<th>workInProgress</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>第一次生成的 fiber tree</td>
<td>第二次生成的</td>
<td></td>
</tr>
<tr>
<td></td>
<td>与真实显示相同</td>
<td>可不同</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>工作在 commit 阶段进行<br>
深度优先</p>
<h2 id="自己理出的过程">自己理出的过程</h2>
<p>创建组件时</p>
<pre><code class="language-js"><div><span class="hljs-function"><span class="hljs-title">createRoot</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-comment">// 经过若干验证参数</span>
    <span class="hljs-keyword">var</span> root = createContainer(container, ConcurrentRoot, <span class="hljs-literal">null</span>, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError);
                    <span class="hljs-keyword">return</span> createFiberRoot(containerInfo, tag, hydrate, initialChildren, hydrationCallbacks, isStrictMode, concurrentUpdatesByDefaultOverride, identifierPrefix, onRecoverableError);
                            <span class="hljs-keyword">let</span> root = FiberRootNode(...)
                            <span class="hljs-keyword">var</span> uninitializedFiber = createHostRootFiber(tag, isStrictMode); <span class="hljs-comment">// 返回FiberNode对象</span>
                                                        <span class="hljs-keyword">return</span> createFiber(...)
                                                            <span class="hljs-keyword">return</span> FiberNode(...)
                            root.current = uninitializedFiber;
                            uninitializedFiber.stateNode = root;
                            initializeUpdateQueue(uninitializedFiber)
                                fiber.updateQueue = {
                                    <span class="hljs-attr">baseState</span>: fiber.memoizedState,
                                    <span class="hljs-attr">firstBaseUpdate</span>: <span class="hljs-literal">null</span>,
                                    <span class="hljs-attr">lastBaseUpdate</span>: <span class="hljs-literal">null</span>,
                                    <span class="hljs-attr">shared</span>: {
                                    <span class="hljs-attr">pending</span>: <span class="hljs-literal">null</span>,
                                    <span class="hljs-attr">lanes</span>: NoLanes,
                                    <span class="hljs-attr">hiddenCallbacks</span>: <span class="hljs-literal">null</span>
                                    },
                                    <span class="hljs-attr">callbacks</span>: <span class="hljs-literal">null</span>
                                };
                            <span class="hljs-keyword">return</span>
                            root;
    markContainerAsRoot(root.current, container); <span class="hljs-comment">// 为了验证参数，在这里做标记</span>
    <span class="hljs-keyword">var</span> rootContainerElement = container.nodeType === COMMENT_NODE ? container.parentNode : container; <span class="hljs-comment">// COMMENT_NODE 是注释节点的码值 8</span>
    <span class="hljs-comment">// rootContainerElement      dom</span>
    listenToAllSupportedEvents(rootContainerElement);
        <span class="hljs-comment">// 它里面调用的方法太多了。</span>
        <span class="hljs-comment">// listenToNativeEvent</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReactDOMRoot(root);
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ReactDOMRoot</span>(<span class="hljs-params">internalRoot</span>) </span>{
                    <span class="hljs-built_in">this</span>._internalRoot = internalRoot;
                }
                ReactDOMRoot.prototype.render = <span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">var</span> root = <span class="hljs-built_in">this</span>._internalRoot;
                    updateContainer(children, root, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
                }
                ReactDOMRoot.prototype.unmount = <span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">var</span> root = <span class="hljs-built_in">this</span>._internalRoot;
                }

}
</div></code></pre>
<p>更新组件时</p>
<pre><code><code><div>ReactDOMRoot
</div></code></code></pre>
<h2 id="常用对象">常用对象</h2>
<pre><code class="language-js"><div>ReactElement
{
  <span class="hljs-string">&quot;$$typeof&quot;</span>: <span class="hljs-built_in">Symbol</span>(react.element) <span class="hljs-comment">// 惟一标记</span>
  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;h1&quot;</span>, <span class="hljs-comment">// html标签 | 构造函数</span>
  <span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-literal">null</span>,  <span class="hljs-comment">// 惟一键</span>
  <span class="hljs-string">&quot;ref&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;props&quot;</span>: {
    <span class="hljs-string">&quot;children&quot;</span>: <span class="hljs-string">&quot;title&quot;</span>
  },
  <span class="hljs-string">&quot;_owner&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;_store&quot;</span>: {},
  <span class="hljs-string">&quot;_self&quot;</span>: <span class="hljs-literal">null</span>
  <span class="hljs-string">&quot;_source&quot;</span>: <span class="hljs-literal">null</span>
}

FiberNode 也有人叫 Fiber
{
  <span class="hljs-string">&quot;tag&quot;</span>: <span class="hljs-number">5</span>,
  <span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-literal">null</span>,          <span class="hljs-comment">// key 兄弟间惟一</span>
  <span class="hljs-string">&quot;elementType&quot;</span>: <span class="hljs-literal">null</span>,  <span class="hljs-comment">// 构造函数 | html标签</span>
  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-literal">null</span>,         <span class="hljs-comment">// 组件的类型。与elementType相同值。createFiberFromTypeAndProps</span>
  <span class="hljs-string">&quot;stateNode&quot;</span>: <span class="hljs-literal">null</span>,    <span class="hljs-comment">// dom | FiberRootNode</span>
  <span class="hljs-string">&quot;return&quot;</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// 父 FiberNode</span>
  <span class="hljs-string">&quot;child&quot;</span>: <span class="hljs-literal">null</span>,        <span class="hljs-comment">// 第一个子元素</span>
  <span class="hljs-string">&quot;sibling&quot;</span>: <span class="hljs-literal">null</span>,      <span class="hljs-comment">// 后面的第一个兄弟元素</span>
  <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">0</span>,           <span class="hljs-comment">// 兄弟间下标</span>
  <span class="hljs-string">&quot;ref&quot;</span>: <span class="hljs-literal">null</span>,          <span class="hljs-comment">// ref</span>
  <span class="hljs-string">&quot;pendingProps&quot;</span>: {     <span class="hljs-comment">// 这些props被修改后应该传入子组件或dom</span>
    <span class="hljs-string">&quot;children&quot;</span>: {
      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;h1&quot;</span>,
      <span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;ref&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;props&quot;</span>: {
        <span class="hljs-string">&quot;children&quot;</span>: <span class="hljs-string">&quot;title&quot;</span>
      },
      <span class="hljs-string">&quot;_owner&quot;</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">&quot;_store&quot;</span>: {}
    }
  },
  <span class="hljs-string">&quot;memoizedProps&quot;</span>: <span class="hljs-literal">null</span>,    <span class="hljs-comment">// 输出更新后节点需要使用的props</span>
  <span class="hljs-string">&quot;updateQueue&quot;</span>: <span class="hljs-literal">null</span>,      <span class="hljs-comment">// 更新队列。详见下文。</span>
  <span class="hljs-string">&quot;memoizedState&quot;</span>: <span class="hljs-literal">null</span>,    <span class="hljs-comment">// 上次渲染组件是使用的状态。初始化FiberNode节点时会赋初始值。</span>
                            <span class="hljs-comment">// 输出更新后节点需要使用的state</span>
                {           <span class="hljs-comment">// 这是一个hook对象</span>
                  baseState,
                  next,         <span class="hljs-comment">// 指向下一次useState对应的hook对象</span>
                                <span class="hljs-comment">// 又是链表</span>
                  baseUpdate,
                  queue,
                  memoizedState, <span class="hljs-comment">// useState返回的结果</span>
                }
  <span class="hljs-string">&quot;dependencies&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-number">3</span>,
  <span class="hljs-string">&quot;flags&quot;</span>: <span class="hljs-number">0</span>,               <span class="hljs-comment">// 该节点的side-effect。功能同原来的effectTag</span>
  <span class="hljs-string">&quot;subtreeFlags&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;deletions&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;lanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;childLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;alternate&quot;</span>: <span class="hljs-literal">null</span>,        <span class="hljs-comment">// 指向在另一棵树上对应的节点</span>
  <span class="hljs-string">&quot;actualDuration&quot;</span>: <span class="hljs-number">0</span>,      <span class="hljs-comment">//</span>
  <span class="hljs-string">&quot;actualStartTime&quot;</span>: -<span class="hljs-number">1</span>,    <span class="hljs-comment">// 好像是开始更新的时刻，相对于根组件被创建的时间。</span>
  <span class="hljs-string">&quot;selfBaseDuration&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;treeBaseDuration&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;_debugSource&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;_debugOwner&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;_debugNeedsRemount&quot;</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;_debugHookTypes&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-comment">// effectTag: xxxxx              // 该节点的side-effect</span>
}

FiberRootNode
{
  <span class="hljs-string">&quot;tag&quot;</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">&quot;containerInfo&quot;</span>: {},      <span class="hljs-comment">// 就是createRoot的第一个参数。dom类型。</span>
  <span class="hljs-string">&quot;pendingChildren&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;current&quot;</span>: <span class="hljs-literal">null</span>,          <span class="hljs-comment">// FiberNode。它是在createRoot方法中被设置的。</span>
  <span class="hljs-string">&quot;pingCache&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;finishedWork&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;timeoutHandle&quot;</span>: -<span class="hljs-number">1</span>,
  <span class="hljs-string">&quot;context&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;pendingContext&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;callbackNode&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;callbackPriority&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;eventTimes&quot;</span>: [ <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ],
  <span class="hljs-string">&quot;expirationTimes&quot;</span>: [ -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span> ],
  <span class="hljs-string">&quot;pendingLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;suspendedLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;pingedLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;expiredLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;mutableReadLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;finishedLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;entangledLanes&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;entanglements&quot;</span>: [ <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ],
  <span class="hljs-string">&quot;identifierPrefix&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
  <span class="hljs-string">&quot;mutableSourceEagerHydrationData&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-string">&quot;effectDuration&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;passiveEffectDuration&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;memoizedUpdaters&quot;</span>: {},
  <span class="hljs-string">&quot;pendingUpdatersLaneMap&quot;</span>: [ {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {} ],
  <span class="hljs-string">&quot;_debugRootType&quot;</span>: <span class="hljs-string">&quot;createRoot()&quot;</span>
}

update = {
  <span class="hljs-attr">eventTime</span>: eventTime,
  <span class="hljs-attr">lane</span>: lane,
  <span class="hljs-attr">tag</span>: UpdateState,
  <span class="hljs-attr">payload</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">callback</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>
};

current 指向 FiberRootNode

<span class="hljs-attr">ReactWorkTags</span>:
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> FunctionComponent = <span class="hljs-number">0</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ClassComponent = <span class="hljs-number">1</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> IndeterminateComponent = <span class="hljs-number">2</span>; <span class="hljs-comment">// Before we know whether it is function or class</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> HostRoot = <span class="hljs-number">3</span>; <span class="hljs-comment">// Root of a host tree. Could be nested inside another node.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> HostPortal = <span class="hljs-number">4</span>; <span class="hljs-comment">// A subtree. Could be an entry point to a different renderer.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> HostComponent = <span class="hljs-number">5</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> HostText = <span class="hljs-number">6</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Fragment = <span class="hljs-number">7</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Mode = <span class="hljs-number">8</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ContextConsumer = <span class="hljs-number">9</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ContextProvider = <span class="hljs-number">10</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ForwardRef = <span class="hljs-number">11</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Profiler = <span class="hljs-number">12</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> SuspenseComponent = <span class="hljs-number">13</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> MemoComponent = <span class="hljs-number">14</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> SimpleMemoComponent = <span class="hljs-number">15</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> LazyComponent = <span class="hljs-number">16</span>;
<span class="hljs-comment">// 还17 、 18 不在这里</span>

flags 表示effect的编码
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> NoFlags = <span class="hljs-comment">/*                      */</span> <span class="hljs-number">0b00000000000000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PerformedWork = <span class="hljs-comment">/*                */</span> <span class="hljs-number">0b00000000000000000000000001</span>;
<span class="hljs-comment">// You can change the rest (and add more).</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Placement = <span class="hljs-comment">/*                    */</span> <span class="hljs-number">0b00000000000000000000000010</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Update = <span class="hljs-comment">/*                       */</span> <span class="hljs-number">0b00000000000000000000000100</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ChildDeletion = <span class="hljs-comment">/*                */</span> <span class="hljs-number">0b00000000000000000000001000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ContentReset = <span class="hljs-comment">/*                 */</span> <span class="hljs-number">0b00000000000000000000010000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Callback = <span class="hljs-comment">/*                     */</span> <span class="hljs-number">0b00000000000000000000100000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> DidCapture = <span class="hljs-comment">/*                   */</span> <span class="hljs-number">0b00000000000000000001000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ForceClientRender = <span class="hljs-comment">/*            */</span> <span class="hljs-number">0b00000000000000000010000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Ref = <span class="hljs-comment">/*                          */</span> <span class="hljs-number">0b00000000000000000100000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Snapshot = <span class="hljs-comment">/*                     */</span> <span class="hljs-number">0b00000000000000001000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Passive = <span class="hljs-comment">/*                      */</span> <span class="hljs-number">0b00000000000000010000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Hydrating = <span class="hljs-comment">/*                    */</span> <span class="hljs-number">0b00000000000000100000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Visibility = <span class="hljs-comment">/*                   */</span> <span class="hljs-number">0b00000000000001000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> StoreConsistency = <span class="hljs-comment">/*             */</span> <span class="hljs-number">0b00000000000010000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> LifecycleEffectMask =
  Passive | Update | Callback | Ref | Snapshot | StoreConsistency;
<span class="hljs-comment">// Union of all commit flags (flags with the lifetime of a particular commit)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> HostEffectMask = <span class="hljs-comment">/*               */</span> <span class="hljs-number">0b00000000000011111111111111</span>;
<span class="hljs-comment">// These are not really side effects, but we still reuse this field.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Incomplete = <span class="hljs-comment">/*                   */</span> <span class="hljs-number">0b00000000000100000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ShouldCapture = <span class="hljs-comment">/*                */</span> <span class="hljs-number">0b00000000001000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ForceUpdateForLegacySuspense = <span class="hljs-comment">/* */</span> <span class="hljs-number">0b00000000010000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> DidPropagateContext = <span class="hljs-comment">/*          */</span> <span class="hljs-number">0b00000000100000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> NeedsPropagation = <span class="hljs-comment">/*             */</span> <span class="hljs-number">0b00000001000000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Forked = <span class="hljs-comment">/*                       */</span> <span class="hljs-number">0b00000010000000000000000000</span>;
<span class="hljs-comment">// Static tags describe aspects of a fiber that are not specific to a render,</span>
<span class="hljs-comment">// e.g. a fiber uses a passive effect (even if there are no updates on this particular render).</span>
<span class="hljs-comment">// This enables us to defer more work in the unmount case,</span>
<span class="hljs-comment">// since we can defer traversing the tree during layout to look for Passive effects,</span>
<span class="hljs-comment">// and instead rely on the static flag as a signal that there may be cleanup work.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> RefStatic = <span class="hljs-comment">/*                    */</span> <span class="hljs-number">0b00000100000000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> LayoutStatic = <span class="hljs-comment">/*                 */</span> <span class="hljs-number">0b00001000000000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PassiveStatic = <span class="hljs-comment">/*                */</span> <span class="hljs-number">0b00010000000000000000000000</span>;
<span class="hljs-comment">// Flag used to identify newly inserted fibers. It isn&#x27;t reset after commit unlike `Placement`.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PlacementDEV = <span class="hljs-comment">/*                 */</span> <span class="hljs-number">0b00100000000000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> MountLayoutDev = <span class="hljs-comment">/*               */</span> <span class="hljs-number">0b01000000000000000000000000</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> MountPassiveDev = <span class="hljs-comment">/*              */</span> <span class="hljs-number">0b10000000000000000000000000</span>;
</div></code></pre>
<h2 id="使用本地-reactreact-dom"><a href="/framework/react/useLocalReact.html">使用本地 react/react-dom</a></h2>
<h2 id="hooks-的工作原理">hooks 的工作原理</h2>
<p>更新是如何发生：</p>
<p>调用useState，内部通过setState修改状态后，调用scheduleUpdate方法，从根节点执行完整的dom-diff比较，进行组件的更新。</p>
<p>为什么不能再条件语句或循环中使用Hook</p>
<p>从实现来看，每次hook的执行，都是从索引为0即第一个hook开始执行。也是依靠索引记录当前操作的Hook，假如使用条件语句或者循环，那么hook执行的顺序可能与我们在数组中存放的顺序不一致，就会乱掉。因此不能在条件语句或循环中使用Hook。</p>
<p>方法组件中使用<code>memoizedState</code>属性保存state。
<code>FiberNode.memoizedState</code><br>
一个组件的多个useState()使用链表的方式串起来。<br>
在方法组件更新时会执行完整的方法体。所以会依次执行useState()。若把useState()写在非顶级，则有可能不会执行全部useState()，这样会引发<code>memoizedState</code>链出错。</p>
<p>hooks的状态数据是存放在对应的函数组件的fiber.memoizedState；<br>
一个函数组件上如果有多个hook，他们会通过声明的顺序以链表的结构存储；</p>
<h2 id="tittle">tittle</h2>
<h2 id="tittle-1">tittle</h2>
<h2 id="tittle-2">tittle</h2>
<h1 id="本地笔记">本地笔记</h1>
<h2 id="inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react">Inside Fiber: in-depth overview of the new reconciliation algorithm in React</h2>
<p>jsx 代码 =》 ReactElement =&gt; FiberRootNode/FiberNode</p>
<h3 id="fibernode">FiberNode</h3>
<ul>
<li>每一个 ReactElement 都有一个对应的 FiberNode</li>
<li>它是可变对象，在渲染时不会重新创建。</li>
<li>包含组件的状态、dom</li>
<li>代表工作单元</li>
<li>提供工作路径、时间表、暂停、打断</li>
<li>使用 createFiberFromTypeAndProps 创建 FiberNode</li>
<li>三向链表结构。child/sibling/return</li>
</ul>
<h3 id="current--workinprogress">current &amp; workInProgress</h3>
<table>
<thead>
<tr>
<th></th>
<th>current</th>
<th>workInProgress</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>当前 dom 的 vdom 树</td>
<td>改变的状态需要更新的节点树。</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>它是工作的终点</td>
<td>从此树开始执行</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>每个节点使用 render 方法创建新的 ReactElement。再由新的 ReactElement 生成 workInProgress</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>不为用户提供服务。是 react 内置的用于缓存的对象。</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol>
<li>当完成所有 workInProgress 树的工作后</li>
<li>开始同步更新 dom.</li>
<li>此树成为 current 树。</li>
</ol>
<p>react 只更新 dom</p>
<h3 id="side-effects">side-effects</h3>
<ul>
<li><strong>操作 dom 的方法</strong></li>
<li><strong>生命周期方法</strong></li>
<li>……</li>
</ul>
<h3 id="effect-list">effect list</h3>
<p>根据 FiberNode 链表结构依次处理<br>
处理链表比处理树快。<br>
firstEffect 指向第一个节点。nextEffect 指向下一个节点。单向链表。</p>
<h3 id="root-of-the-fiber-tree">root of the fiber tree</h3>
<p>使用变量 container 指定根节点的容器。它是 dom 元素。<br>
current 指向 FiberRootNode<br>
根节点是 HostRoot<br>
FiberRootNode.stateNode 指向 HostRoot</p>
<h3 id="general-algorithm">general algorithm</h3>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>render phase</td>
<td>异步</td>
<td>操作 workInProgress/current</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>getDerivedStateFromProps</td>
<td>被反对的生命周期方法不列出来</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>shouldComponentUpdate</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>render</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>commit phase</td>
<td>同步</td>
<td>操作 dom</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>getSnapshotBeforeUpdate</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>componentDidMount</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>componentDidUdate</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>componentWillUnmount</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>调用 setState/React.render 会把对应的 FiberNode 指定为需要更新的元素。</p>
<h4 id="render-phase">render phase</h4>
<p>使用 effectTag 标记该节点应该如何更新。更新工作会在 commit 阶段做。<br>
此阶段不能执行 side-effect
从根节点开始，然后深度优先，跳过不需要更新的节点 FiberNode，标记出需要更新的节点 FiberNode。</p>
<ul>
<li>nextUnitOfWork</li>
<li>performUnitOfWork 参数是 workInProgress</li>
<li>beginWork // 返回下一个子节点或 null</li>
<li>completeUnitOfWork //</li>
<li>completeWork</li>
</ul>
<p>按照 FiberNode 形成的链表，深度优先。</p>
<h4 id="commit-phase">commit phase</h4>
<p>从 completeWork 开始。<br>
主要在 commitRoot 方法中<br>
因为要改变视图，所以必须是同步。<br>
当调用<code>finishedWork</code>时更新视图。</p>
<ul>
<li>标记了 Snapshot 的 node 会执行 getSnapshotBeforeUpdate 方法</li>
<li>标记了 Deletion 的 node 会执行 componentWillUnmount 方法</li>
<li>执行所有节点的插入、更新、删除操作 commitAllHostEffects</li>
<li>设置新的 current</li>
<li>标记了 Placement 的 node 会执行 componentDidMount 方法</li>
<li>标记了 Update 的 node 会执行 componentDidUpdate 方法</li>
</ul>
<h2 id="in-depth-explanation-of-state-and-props-update-in-react"><a href="https://indepth.dev/posts/1009/in-depth-explanation-of-state-and-props-update-in-react">In-depth explanation of state and props update in React</a></h2>
<h3 id="scheduling-updates">scheduling updates</h3>
<pre><code class="language-js"><div>当组件需要更新时
{
    <span class="hljs-attr">effectTag</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">elementType</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClickCounter</span>,
    <span class="hljs-title">firstEffect</span>: <span class="hljs-title">null</span>,
    <span class="hljs-title">memoizedState</span>: </span>{count: <span class="hljs-number">0</span>},
    <span class="hljs-attr">type</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClickCounter</span>,
    <span class="hljs-title">stateNode</span>: </span>{
        <span class="hljs-attr">state</span>: {<span class="hljs-attr">count</span>: <span class="hljs-number">0</span>}
    },
    <span class="hljs-attr">updateQueue</span>: {
        <span class="hljs-attr">baseState</span>: {<span class="hljs-attr">count</span>: <span class="hljs-number">0</span>},
        <span class="hljs-attr">firstUpdate</span>: {
            <span class="hljs-attr">next</span>: {
                <span class="hljs-attr">payload</span>: <span class="hljs-function">(<span class="hljs-params">state, props</span>) =&gt;</span> {…}
            }
        },
        ...
    }
}
更新后
{
    <span class="hljs-attr">effectTag</span>: <span class="hljs-number">4</span>, <span class="hljs-comment">// 源码中使用二进制表示   100</span>
    <span class="hljs-comment">// 因这里标记为 Update 所以会执行此节点的componentDidUpdate生命周期方法</span>
    <span class="hljs-attr">elementType</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClickCounter</span>,
    <span class="hljs-title">firstEffect</span>: <span class="hljs-title">null</span>,
    <span class="hljs-title">memoizedState</span>: </span>{count: <span class="hljs-number">1</span>},
    <span class="hljs-attr">type</span>: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClickCounter</span>,
    <span class="hljs-title">stateNode</span>: </span>{
        <span class="hljs-attr">state</span>: {<span class="hljs-attr">count</span>: <span class="hljs-number">1</span>}
    },
    <span class="hljs-attr">updateQueue</span>: {
        <span class="hljs-attr">baseState</span>: {<span class="hljs-attr">count</span>: <span class="hljs-number">1</span>},
        <span class="hljs-attr">firstUpdate</span>: <span class="hljs-literal">null</span>,
        ...
    }
}


更新前
{
    <span class="hljs-attr">stateNode</span>: <span class="hljs-keyword">new</span> HTMLSpanElement,
    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;span&quot;</span>,
    <span class="hljs-attr">effectTag</span>: <span class="hljs-number">0</span>
    <span class="hljs-attr">updateQueue</span>: <span class="hljs-literal">null</span>
    ...
}
更新后
{
    <span class="hljs-attr">stateNode</span>: <span class="hljs-keyword">new</span> HTMLSpanElement,
    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;span&quot;</span>,
    <span class="hljs-attr">effectTag</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">updateQueue</span>: [<span class="hljs-string">&quot;children&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>],
    ...
}
</div></code></pre>
<p>全局变量 nextUnitOfWork 表示在 workInProgress 树上下一个需要工作的
FiberNode。<br>
若此变量为空，则完成所有工作。</p>
<ol>
<li>当执行 setState 时，会在该组件对应的 FiberNode 的 uqdateQueue 中添加工作。</li>
<li>进入 render 阶段。</li>
<li>调用 renderRoot 方法。从 HostRoot(它一个 FiberNode)开始，会跳过完成工作的 FiberNode，直到未完成工作的 FiberNode.</li>
<li>调用 createWorkInProgress 方法，根据
ReactElement 创建 workInProgress.</li>
<li>调用 beginWork 方法。根据 type 分别调用相应的方法。如<code>updateClassComponent() 、 updateFunctionComponent()</code>。会创建并挂载组件的实例或更新实例。</li>
<li>调用 updateClassInstance 方法，去更新组件。然后依次调用：
<ol>
<li>UNSAFE_componentWillReceiveProps() deprecated</li>
<li>执行 updateQueue 里的方法。会得到新的 state</li>
<li>使用新 state 调用 getDerivedStateFromProps 方法。</li>
<li>执行 shouldComponentUpdate 方法。若返回 false，则跳过整个渲染处理（包括该组件的 render 方法及其子组件的 render 方法）。否则执行更新。</li>
<li>调用 UNSAFE_componentWillUpdate（） deprecated</li>
<li>添加一个触发 componentDidUpdate()的 effect 在 render 阶段中是添加。实际执行在 commit 阶段。</li>
</ol>
</li>
<li>更新实例的 state/props。 为执行 render 方法做准备。</li>
<li>执行 finishClassComponent 方法。react 会调用 render 方法，得到新组件实例，再执行 diffing 运算。
<ol>
<li>执行 createWorkInProgress 方法，根据新的 ReactElement 对象得到替补节点（它是 FiberNode）</li>
<li>在 FiberNode.pendingProps 的数据会作用于子组件。</li>
<li>子组件中使用 memoizedProps</li>
<li>为 nextUnitOfWork 赋值。 其中的处理逻辑同上。</li>
</ol>
</li>
<li>调用 updateHostComponent 方法，结束。</li>
</ol>
<h3 id="commit-phase-1">commit phase</h3>
<ol>
<li>从调用 completeRoot 方法开始。</li>
<li>设置 FiberRootNode.finishedWork 为 null</li>
<li>调用 commitBeforeMutationLifeCycles 方法。若标记 snapshot 则执行 getSnapshotBeforeUpdate()</li>
<li>调用 commitAllHostEffects 方法。</li>
<li>调用 updateDOMProperties 方法
<ol>
<li>把 uqdateQueue 中的 payload 传入 render 方法并执行。</li>
</ol>
</li>
<li>调用 finishedWork 方法。把 workInProgress 赋值给 current</li>
<li>调用 commitAllLifecycles 方法。调用所有的生命周期方法。
<ol>
<li>调用 commitLifeCycles 方法。会更新 refs 引入。 componentDidMount 会只执行一次。</li>
</ol>
</li>
</ol>
<h3 id="处理-fibernode-的更新">处理 FiberNode 的更新</h3>
<p>全局变量保留了 workInProgress 中需要工作的 FiberNode。用它表明是否完成工作。<br>
使用<code>renderRoot()</code>从<code>HostRoot</code>FiberNode 开始工作（这是 render 阶段）。<br>
使用<code>createWorkInProgress()</code>创建一个该 FiberNode 的替补节点。更新操作都在这个替补节点上工作。</p>
<h3 id="the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-to-walk-the-components-tree"><a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7">The how and why on React’s usage of linked list in Fiber to walk the component’s tree</a></h3>
<h1 id="参考文档">参考文档</h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=7YhdqIR2Yzo&amp;t=422s">youtobe philip fabinek react</a></li>
<li><a href="https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e">https://medium.com/react-in-depth/inside-fiber-in-depth-overview-of-the-new-reconciliation-algorithm-in-react-e1c04700ef6e</a></li>
<li><a href="https://indepth.dev/posts/1009/in-depth-explanation-of-state-and-props-update-in-react">https://indepth.dev/posts/1009/in-depth-explanation-of-state-and-props-update-in-react</a></li>
<li><a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7">https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7</a></li>
<li><a href=""></a></li>
<li><a href=""></a></li>
<li><a href=""></a></li>
</ul>
<h1 id="开拓">开拓</h1>
<h2 id="babel-开创了前端中把一种功能由一种写法的思想如">babel 开创了前端中把一种功能由一种写法的思想。如:</h2>
<pre><code><code><div>&lt;span id=&quot;#id&quot;&gt;string&lt;/span&gt;
=&gt;
React.createElement('span', {id: '#id'}, string)
</div></code></code></pre>
<h2 id="使用配置文件控制是否使用新代码同时保持了新代码与老代码在项目中优点是迭代平滑">使用配置文件控制是否使用新代码。同时保持了新代码与老代码在项目中。优点是迭代平滑。</h2>
<h2 id="title">title</h2>
<h2 id="title-1">title</h2>
<h2 id="title-2">title</h2>
<h2 id="title-3">title</h2>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>