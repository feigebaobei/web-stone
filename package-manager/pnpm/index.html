<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&DiacriticalGrave;pnpm&DiacriticalGrave;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="pnpm"><code>pnpm</code></h1>
<h2 id="overview">overview</h2>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>快</td>
<td>比 npm/yarn 提速 2 倍以上</td>
<td>使用“可寻址文件系统”（content-addressable filesystem）</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>快速、有效.<br>
支持一库多包。<br>
创建非平的 node_modules(树型的)。不支持直接访问包。<br>
通过指定工作空间去实现。<br>
与<code>corepack</code>一起工作。</p>
</blockquote>
<h3 id="feature">feature</h3>
<ul>
<li>多包一库管理工具。</li>
<li>包管理工具，比 npm/yarn 强大。用法上与竞品无区别，内部逻辑不同。</li>
<li>会检验所有参数。若一个参数出错，则无法执行。</li>
<li>pnpm run cmd &lt;=&gt; pnpm cmd. 若找到具名脚本则执行引脚本，否则当作 shell 执行。</li>
<li>pnpm 使用 npm 的配置。</li>
<li>有自己的锁文件。</li>
<li>管理 node 环境。</li>
</ul>
<h2 id="install">install</h2>
<h3 id="非-nodejs-环境">非 node.js 环境</h3>
<pre><code class="language-shell">// posix system
curl -fsSL https://get.pnpm.io/install.sh | sh -
// or
wget -qO- https://get.pnpm.io/install.sh | sh -
brew install pnpm
winget install pnpm
scoop install nodejs-lts pnpm
choco install pnpm
</code></pre>
<h3 id="nodejs-环境">node.js 环境</h3>
<pre><code class="language-shell">// macos
curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm
// windows
(Invoke-WebRequest &#x27;https://get.pnpm.io/v6.16.js&#x27; -UseBasicParsing).Content | node - add --global pnpm
</code></pre>
<h3 id="使用其他包管理工具安装">使用其他包管理工具安装</h3>
<pre><code class="language-shell">npm i pnpm -g
<span class="hljs-meta prompt_"># </span><span class="language-bash">or</span>
yarn global add pnpm
</code></pre>
<h2 id="usage">usage</h2>
<p>在 node v16.13+ 发布了 corepack 来管理包管理工具。但是它默认不启用。需要执行<code>corepack enable</code>才能启动。</p>
<pre><code class="language-shell">pnpm install &lt;packageName&gt;
pnpm add pn # 安装到dependencies
pnpm add -D pn # 安装到devDependencies
pnpm add -O pn
pnpm add -g pn
pnpm add pn@next
pnpm add pn@3.0.0
pnpm install # =&gt; npm install
pnpm add &lt;pkg&gt; # =&gt; npm i &lt;pkg&gt;
pnpm &lt;cmd&gt; # =&gt; npm run &lt;cmd&gt;
</code></pre>
<h3 id="定义别名">定义别名</h3>
<p>在<code>.bashrc</code>或<code>.zshrc</code>或<code> .fish</code>中添加：<code>alias pn=pnpm</code></p>
<h3 id="uninstall">uninstall</h3>
<pre><code class="language-shell">pnpm ls -g # 列出所有全局包
pnpm rm -g &lt;pkg&gt;... # 列出每个全局包
pnpm root -g # 找到全局目录的位置并手动删除它
<span class="hljs-meta prompt_"># </span><span class="language-bash">使用独立脚本安装后，使用此命令移除</span>
rm -rf $PNPM_HOME
<span class="hljs-meta prompt_"># </span><span class="language-bash">使用npm安装后，使用此命令移除</span>
npm rm -g pnpm
rm -rf $(pnpm store path) # 删除全局内容可寻址存储
</code></pre>
<h3 id="过滤">过滤</h3>
<pre><code>pnpm --filter
pnpm --filter ./packages/&lt;name&gt; add &lt;package&gt;
</code></pre>
<h2 id="configuration">configuration</h2>
<p>使用<code>npm</code>的配置
默认配置文件：<code>&lt;root&gt;/.npmrc</code>。</p>
<table>
<thead>
<tr>
<th>key</th>
<th>description</th>
<th>default</th>
<th>enum</th>
<th>demo</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="packagejson">package.json</h3>
<p>详见 <a href="/package-manager/npm/index.html">npm</a> 的 package.json 各字段说明</p>
<h3 id="npmrc"><a href="/package-manager/pnpm/npmrc.html">.npmrc</a></h3>
<p>pnpm 会加载配置项、环境变量。</p>
<ul>
<li>当前项目中的 <code>/path/to/my/project/.npmrc</code></li>
<li>当前工作空间的<code>pnpm-workspace.yaml</code></li>
<li>当前用户的<code>~/.npmrc</code></li>
<li>当前设备的<code>/etc/npmrc</code></li>
</ul>
<h3 id="pnpm-workspaceyaml">pnpm-workspace.yaml</h3>
<p>示例</p>
<pre><code class="language-yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-comment"># all packages in direct subdirs of packages/</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;packages/*&#x27;</span>
  <span class="hljs-comment"># all packages in subdirs of components/</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;components/**&#x27;</span>
  <span class="hljs-comment"># exclude packages that are inside test directories</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;!**/test/**&#x27;</span>
</code></pre>
<h3 id="pnpmfilecjs">.pnpmfile.cjs</h3>
<h2 id="cli">cli</h2>
<p>该包有一库多包管理功能，所以一定要有处理多个工作工作空间、子包的命令。<code>--filter</code></p>
<p>未完。</p>
<!-- prettier-ignore-start -->
<table>
<thead>
<tr>
<th>命令</th>
<th>简写</th>
<th>说明</th>
<th>对比</th>
<th>选项</th>
</tr>
</thead>
<tbody>
<tr>
<td>add</td>
<td></td>
<td>安装包</td>
<td>同<code>npm install &lt;pkg&gt;</code></td>
<td>-P -D -O -E --save-peer -g --workspace <code>--filter &lt;package_selector&gt;</code></td>
</tr>
<tr>
<td>import</td>
<td></td>
<td>从其他锁文件（<code>package-lock.json / npm-shrinkwrap.json / yarn.json</code>）生成 pnpm-lock.yaml</td>
<td></td>
<td></td>
</tr>
<tr>
<td>install</td>
<td>i</td>
<td>安装所有依赖</td>
<td>同<code>npm install</code></td>
<td>--force --offline -P --ignore-scripts</td>
</tr>
<tr>
<td>install-test</td>
<td>it</td>
<td>执行完 pnpm install 后执行 pnpm test</td>
<td></td>
<td>无选项</td>
</tr>
<tr>
<td>link</td>
<td>ln</td>
<td>创立本地软链接</td>
<td></td>
<td><code>--dir &lt;dir&gt;</code> -C</td>
</tr>
<tr>
<td>unlink</td>
<td></td>
<td>取消本地软链接</td>
<td></td>
<td>-r <code>--filter &lt;package_selector&gt;</code></td>
</tr>
<tr>
<td>prune</td>
<td></td>
<td>删除无关联的依赖包</td>
<td></td>
<td>--prod --no-optional</td>
</tr>
<tr>
<td>rebuild</td>
<td>rb</td>
<td>重新打包</td>
<td></td>
<td></td>
</tr>
<tr>
<td>remove</td>
<td>rm</td>
<td>删除本项目的 node_modules</td>
<td></td>
<td>-r -g -O -P --filter</td>
</tr>
<tr>
<td>unlink</td>
<td></td>
<td>取消本地软链接</td>
<td></td>
<td></td>
</tr>
<tr>
<td>update</td>
<td>up</td>
<td>更新依赖包成为允许的最新版本</td>
<td></td>
<td>--latest -L -g --workspace -P -D</td>
</tr>
<tr>
<td>audit</td>
<td></td>
<td>检查不安全的依赖</td>
<td></td>
<td><code>--audit-level &lt;severity&gt;</code> --json -D -P</td>
</tr>
<tr>
<td>list</td>
<td>ls</td>
<td>以树状结构列出所有依赖</td>
<td></td>
<td>-r --json --long -g -P -D</td>
</tr>
<tr>
<td>outdated</td>
<td></td>
<td>检测过时的依赖包</td>
<td></td>
<td>-r -g --long -D -P</td>
</tr>
<tr>
<td>exec</td>
<td></td>
<td>(已经在node_modules/.bin中添加PATH)执行指定 command.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>run</td>
<td></td>
<td>执行指定脚本</td>
<td>同<code>npm run</code></td>
<td></td>
</tr>
<tr>
<td>start</td>
<td></td>
<td>执行 start 脚本</td>
<td></td>
<td></td>
</tr>
<tr>
<td>test</td>
<td></td>
<td>执行 test 脚本</td>
<td></td>
<td></td>
</tr>
<tr>
<td>pack</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>publish</td>
<td></td>
<td>发布包。会触发的生命周期方法<code>prepublishOnly prepublish prepack postpack publish postpublish</code></td>
<td><code>pnpm publish &lt;name&gt; [flags]</code></td>
<td>-r --json <code>--tag &lt;tag&gt;</code> --force --dry-run</td>
</tr>
<tr>
<td>root</td>
<td></td>
<td>显示有效的模块目录</td>
<td></td>
<td></td>
</tr>
<tr>
<td>bin</td>
<td></td>
<td>可执行命令的目录</td>
<td></td>
<td></td>
</tr>
<tr>
<td>dedupe</td>
<td></td>
<td>移除旧版本（相当于现有node_modules中的版本号）的包</td>
<td></td>
<td>--check</td>
</tr>
<tr>
<td>fetch</td>
<td></td>
<td>不会</td>
<td></td>
<td>-D -P</td>
</tr>
<tr>
<td>patch</td>
<td></td>
<td>提取一个包到临时目录。为了修改此包中的内容。</td>
<td></td>
<td><code>--edit-dir &lt;dir&gt;</code></td>
</tr>
<tr>
<td><code>patch-commit &lt;path&gt;</code></td>
<td></td>
<td>提取出一个目录</td>
<td></td>
<td></td>
</tr>
<tr>
<td>why</td>
<td></td>
<td>显示所有包的依赖关系</td>
<td></td>
<td>-r --json --long -g -P -D</td>
</tr>
<tr>
<td>licenses</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>dlx</td>
<td></td>
<td>安装依赖并不写package.json,运行默认命令。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>create</td>
<td></td>
<td>从<code>create-*</code>/<code>@foo/create-*</code>开始工具中创建项目</td>
<td></td>
<td>无选项</td>
</tr>
<tr>
<td><code>env &lt;cmd&gt;</code></td>
<td></td>
<td>管理node环境</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td><code>pnpm env use --global lts</code></td>
<td>安装并使用指定版本</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td><code>pnpm env remove --global 14.0.0</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td><code>pnpm env list</code></td>
<td>--remote</td>
</tr>
<tr>
<td>pack</td>
<td></td>
<td>创建一个tarball包</td>
<td></td>
<td></td>
</tr>
<tr>
<td>server</td>
<td>管理store server</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>store status</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>store add</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>store prune</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>store path</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>setup</td>
<td></td>
<td>用于标准的加载脚本。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>init</td>
<td></td>
<td>创建package.json文件</td>
<td></td>
<td></td>
</tr>
<tr>
<td>deploy</td>
<td></td>
<td>不会</td>
<td></td>
<td></td>
</tr>
<tr>
<td>doctor</td>
<td></td>
<td>不会</td>
<td></td>
<td></td>
</tr>
<tr>
<td>config c</td>
<td></td>
<td>管理配置文件</td>
<td></td>
<td>-g --location --json</td>
</tr>
<tr>
<td><code>config set &lt;key&gt; &lt;value&gt;</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>config get &lt;key&gt;</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>config delete &lt;key&gt;</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>config list</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>config c</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>...还有一些未在 help 中显露的子命令</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<!-- prettier-ignore-end -->
<p><code>-c / --dir</code> 指定工具目录<br>
<code>-w / --workspace-root</code> 指定工具根目录<br>
<code>pnpm exec</code> 运行本地、远端指定包<br>
<code>--filter xxx</code></p>
<h2 id="生命周期脚本">生命周期脚本</h2>
<p><code>devPreinstall</code>。只在本地 pnpm install 时运行。在安装依赖前运行。在根目录中有 package.json 时运行。</p>
<h2 id="workspace">workspace</h2>
<p>一库多包项目可以连接起本地开发包的引用关系。
该类项目的根目录下必须有<code>pnpm-workspace.yaml</code>.有它的目录就是命名空间的根目录。</p>
<h2 id="config">config</h2>
<pre><code class="language-shell">pnpm config list # 查看配置
global-bin-dir=D:\pnpm_node_module
registry=http://registry.npmjs.org/
store-dir=D:\pnpm_node_module
user-agent=pnpm/8.2.0 npm/? node/v16.16.0 win32 x64
pnpm config set store-dir D:\\node\\global # 设置全局地址
pnpm config set cache-dir D:\\node\\cache # 设置缓存地址

</code></pre>
<h2 id="缓存">缓存</h2>
<pre><code>pnpm store path # 查看缓存路径
pnpm store prune # 清空缓存
</code></pre>
<h2 id="api">api</h2>
<h2 id="principle">principle</h2>
<p>此包的处理逻辑。</p>
<h3 id="uml">uml</h3>
<pre><code>
</code></pre>
<h2 id="issue">issue</h2>
<pre><code class="language-shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">检查pnpm的命令位置</span>
which pnpm

</code></pre>
<h2 id="pnpm--lerna">pnpm &amp; lerna</h2>
<table>
<thead>
<tr>
<th></th>
<th>pnpm</th>
<th>lerna</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>作者</td>
<td>一直更新着</td>
<td>被 nx 团队收购后就与 nx 项目强绑定了。再加上后来 api 变化，现在不好用了。</td>
<td></td>
</tr>
<tr>
<td>管理 node 版本</td>
<td>y</td>
<td>n</td>
<td></td>
</tr>
<tr>
<td>一库多包</td>
<td>基于全设备共享依赖来源，+ --filter + workspace 指定安装范围。项目结构</td>
<td>这是它的初衷。在安装依赖、发布包时很方便。</td>
<td></td>
</tr>
<tr>
<td>api</td>
<td>稳定，没变过</td>
<td>一点一点地变。v7+后变得我都不能使用了。</td>
<td></td>
</tr>
<tr>
<td>对项目结构的影响</td>
<td>无影响，一库一包项目相同。</td>
<td>有特定的项目结构。子包都放在指定目录下。</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="todo">todo</h2>
<blockquote>
<p>未来迭代计划。
未来迭代计划。
未来迭代计划。</p>
</blockquote>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>