<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&DiacriticalGrave;yarn&DiacriticalGrave;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="yarn"><code>yarn</code></h1>
<h2 id="overview">overview</h2>
<blockquote>
<p>它是一个包管理工具。类似产品有：npm/pnpm<br>
cli<br>
可以方便分享代码给别的开发者。很快，安全，不会遇到问题。<br>
把项目概述写入<code>package.json</code>中。<br>
yarn2 及以后版本已写入了 corepack 包（它是 node 16.10+内置的包。）。通过<code>corepack</code>管理<code>yarn</code><br>
<code>pnpm</code>把依赖包做成树型的。<code>yarn</code>有可能也把依赖包做成树型的。<br>
可读强的输出日志。
facebook 开发</p>
</blockquote>
<h3 id="feature">feature</h3>
<ul>
<li>offline mode</li>
<li>meterministic</li>
<li>network performance</li>
<li>network resilicense</li>
<li>flat mode // pnpm 是树型结构</li>
<li>0 安装</li>
<li>即插即用</li>
<li>插件文档</li>
<li>支持一库多包</li>
<li>支持多个工作空间</li>
</ul>
<h2 id="install">install</h2>
<p>最好使用<code>corepack</code>管理<code>yarn</code>。<code>corepack</code>是<code>node &gt; 16.10</code>的内置包。默认不使用引包。</p>
<h3 id="安装-yarn-1">安装 yarn 1+</h3>
<pre><code class="language-shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">for</span> yarn 1+</span>
npm i -g yarn
</code></pre>
<h3 id="安装-yarn-2">安装 yarn 2+</h3>
<h4 id="node--160">node &gt;= 16.0</h4>
<pre><code class="language-shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">for</span> yarn 2+ / yarn 3+</span>
corepack enable
yarn set version stable # 更新yarn 默认执行yarn init
</code></pre>
<h4 id="node--160-1">node &lt; 16.0</h4>
<pre><code class="language-shell">npm i -g corepack
</code></pre>
<pre><code class="language-shell">yarn --version # 若返回版本号，则安装成功。
yarn init -2 # init project
yarn set version stable # 更新yarn 默认执行yarn init
yarn set version from sources # 更新到最新的master分支
yarn set version from sources --branch 1211 # 更新为指定的PRs
</code></pre>
<h2 id="usage">usage</h2>
<pre><code class="language-shell">yarn help // 列出命令
yarn init
yarn # 是yarn install 的简写
yarn install # 安装所有依赖
yarn add [package] # 添加依赖包
yarn add [package]@[version]
yarn add [package]@[tag]
yarn add [package] --dev
yarn add [package] --peer
yarn global add [package]
yarn up [package] # 更新指定的包
yarn up [package]@[version] # 更新指定的包到指定版本
yarn up [package]@[tag]
yarn remove [package] # 移除依赖包
yarn set version latest # 更新yarn
yarn set version from sources
</code></pre>
<h2 id="command">command</h2>
<details>
	<summary>错误码</summary>
<pre>
yarn add <package>[@version]|[@url] // 安装依赖包
  --json
  -E --exact
  -T --tilde
  -C --caret
  -D --dev
  -P --peer
  -O --optional
  --prefer-dev
  -i --interactive
  --cached
  --mode #0
<p>yarn bin [name] // 执行二进制脚本
-v --verbose
--json</p>
<p>yarn cache clean // 删除共享的缓存文件
--mirror
--all</p>
<p>yarn config get <name> // 读取配置项
--json
--no-redacted</p>
<p>yarn config set <name> <value> // 设置配置项
--json
-H --home</p>
<p>yarn config unset <name> // 不设置指定配置项
-H --home</p>
<p>yarn config // 列出当前的配置项
-v --verbose
--why
--json</p>
<p>yarn constraints query <query> // Query the constraints fact database.
--json</p>
<p>yarn constraints source // 列出源代码
-v --verbose</p>
<p>yarn constraints // 检测本项目的限制
--fix</p>
<p>yarn dedupe // 删除重复依赖
-s --strategy #0
-c --check
--json
--mode #0</p>
<p>yarn dlx <command> // 在临时环境中运行指定的包
-p --package #0
-q --quiet</p>
<p>yarn exec <commandName> // 执行 shell 脚本</p>
<p>yarn explain peer-requirements</p>
</pre>
</details>
<pre><code class="language-shell">yarn help

  Usage: yarn [command] [flags]

  Displays help information.

  Options:

    --cache-folder &lt;path&gt;               specify a custom folder that must be used to store the yarn cache
    --check-files                       install will verify file tree of packages for consistency
    --cwd &lt;cwd&gt;                         working directory to use (default: /Users/cat/Documents/code/third)
    --disable-pnp                       disable the Plug&#x27;n&#x27;Play installation
    --emoji [bool]                      enable emoji in output (default: true)
    --enable-pnp, --pnp                 enable the Plug&#x27;n&#x27;Play installation
    --flat                              only allow one version of a package
    --focus                             Focus on a single workspace by installing remote copies of its sibling workspaces.
    --force                             install and build packages even if they were built before, overwrite lockfile
    --frozen-lockfile                   don&#x27;t generate a lockfile and fail if an update is needed
    --global-folder &lt;path&gt;              specify a custom folder to store global packages
    --har                               save HAR output of network traffic
    --https-proxy &lt;host&gt;
    --ignore-engines                    ignore engines check
    --ignore-optional                   ignore optional dependencies
    --ignore-platform                   ignore platform checks
    --ignore-scripts                    don&#x27;t run lifecycle scripts
    --json                              format Yarn log messages as lines of JSON (see jsonlines.org)
    --link-duplicates                   create hardlinks to the repeated modules in node_modules
    --link-folder &lt;path&gt;                specify a custom folder to store global links
    --modules-folder &lt;path&gt;             rather than installing modules into the node_modules folder relative to the cwd, output them here
    --mutex &lt;type&gt;[:specifier]          use a mutex to ensure only one yarn instance is executing
    --network-concurrency &lt;number&gt;      maximum number of concurrent network requests
    --network-timeout &lt;milliseconds&gt;    TCP timeout for network requests
    --no-bin-links                      don&#x27;t generate bin links when setting up packages
    --no-default-rc                     prevent Yarn from automatically detecting yarnrc and npmrc files
    --no-lockfile                       don&#x27;t read or generate a lockfile
    --non-interactive                   do not show interactive prompts
    --no-node-version-check             do not warn when using a potentially unsupported Node version
    --no-progress                       disable progress bar
    --offline                           trigger an error if any required dependencies are not available in local cache
    --otp &lt;otpcode&gt;                     one-time password for two factor authentication
    --prefer-offline                    use network only if dependencies are not available in local cache
    --preferred-cache-folder &lt;path&gt;     specify a custom folder to store the yarn cache if possible
    --prod, --production [prod]
    --proxy &lt;host&gt;
    --pure-lockfile                     don&#x27;t generate a lockfile
    --registry &lt;url&gt;                    override configuration registry
    -s, --silent                        skip Yarn console logs, other types of logs (script output) will be printed
    --scripts-prepend-node-path [bool]  prepend the node executable dir to the PATH in scripts
    --skip-integrity-check              run install without checking if node_modules is installed
    --strict-semver
    --update-checksums                  update package checksums from current repository
    --use-yarnrc &lt;path&gt;                 specifies a yarnrc file that Yarn should use (.yarnrc only, not .npmrc) (default: )
    -v, --version                       output the version number
    --verbose                           output verbose messages on internal operations
    -h, --help                          output usage information
  Commands:
    - access
    - add
    - audit
    - autoclean
    - bin
    - cache
    - check
    - config
    - create

    - dlx # 有临时环境中运行包

    - exec
    - generate-lock-entry / generateLockEntry
    - global
    - help
    - import
    - info
    - init
    - install
    - licenses
    - link
    - list
    - login
    - logout
    - node
    - outdated
    - owner
    - pack
    - policies
    - publish
    - remove
    - run
    - tag
    - team
    - unlink
    - unplug
    - upgrade
    - upgrade-interactive / upgradeInteractive
    - version
    - versions
    - why
    - workspace
    - workspaces
</code></pre>
<h2 id="cli">cli</h2>
<p><code>yarn init</code> init project
<code>yarn add [package]</code> add package
<code>yarn add [package]@[version]</code> add package
<code>yarn add [package]@[tag]</code> add package
<code>--dev</code> 安装到 devDependencies
<code>--peer</code> 安装到 peerDependencies
<code>--optional</code> 安装到 optionalDependencies
<code>yarn upgrade [package]</code> upgrade package
<code>yarn upgrade [package]@[version]</code> upgrade package
<code>yarn upgrade [package]@[tag]</code> upgrade package
<code>yarn remove [package]</code> remove package
<code>yarn</code> 安装项目中的依赖
当不确定时不要使用<code>yarn dlx</code>代替<code>yarn add</code>。<code>yarn dlx</code>不会跟踪包的名称、版本。</p>
<h2 id="配置文件">配置文件</h2>
<p>默认配置文件：<code>&lt;root&gt;/.yarnrc</code>。</p>
<table>
<thead>
<tr>
<th>key</th>
<th>description</th>
<th>default</th>
<th>enum</th>
<th>demo</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>yarn-offline-mirror</td>
<td>&quot;./packages-cache&quot;</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>yarn-offline-mirror-pruning</td>
<td>true</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>yarn-path</td>
<td>&quot;./bin/yarn&quot;</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>disable-self-update-check</td>
<td>true</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>child-concurrency</td>
<td>#number#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>unsafe-disable-integrity-migration</td>
<td>false</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>key/value都用<code>&quot;&quot;</code>包裹。</li>
<li>key/value之间使用<code> </code>空格间隔</li>
</ul>
<pre><code>&quot;registry&quot; &quot;https://registry.npmjs.org&quot;
</code></pre>
<h2 id="pnp"><a href="/package-manager/yarn/pnp.html">pnp</a></h2>
<h2 id="编辑器的-sdk"><a href="/package-manager/yarn/editor-sdk.html">编辑器的 sdk</a></h2>
<h2 id="输出日志">输出日志</h2>
<pre><code class="language-shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">&lt;错误码&gt;: &lt;符号&gt;&lt;说明文本&gt;</span>
</code></pre>
<h3 id="错误码">错误码</h3>
<details>
	<summary>错误码</summary>
<pre>
YN0000 - UNNAMED
YN0001 - EXCEPTION
YN0002 - MISSING_PEER_DEPENDENCY
YN0003 - CYCLIC_DEPENDENCIES
YN0004 - DISABLED_BUILD_SCRIPTS
YN0005 - BUILD_DISABLED
YN0006 - SOFT_LINK_BUILD
YN0007 - MUST_BUILD
YN0008 - MUST_REBUILD
YN0009 - BUILD_FAILED
YN0010 - RESOLVER_NOT_FOUND
YN0011 - FETCHER_NOT_FOUND
YN0012 - LINKER_NOT_FOUND
YN0013 - FETCH_NOT_CACHED
YN0014 - YARN_IMPORT_FAILED
YN0015 - REMOTE_INVALID
YN0016 - REMOTE_NOT_FOUND
YN0017 - RESOLUTION_PACK
YN0018 - CACHE_CHECKSUM_MISMATCH
YN0019 - UNUSED_CACHE_ENTRY
YN0020 - MISSING_LOCKFILE_ENTRY
YN0021 - WORKSPACE_NOT_FOUND
YN0022 - TOO_MANY_MATCHING_WORKSPACES
YN0023 - CONSTRAINTS_MISSING_DEPENDENCY
YN0024 - CONSTRAINTS_INCOMPATIBLE_DEPENDENCY
YN0025 - CONSTRAINTS_EXTRANEOUS_DEPENDENCY
YN0026 - CONSTRAINTS_INVALID_DEPENDENCY
YN0027 - CANT_SUGGEST_RESOLUTIONS
YN0028 - FROZEN_LOCKFILE_EXCEPTION
YN0029 - CROSS_DRIVE_VIRTUAL_LOCAL
YN0030 - FETCH_FAILED
YN0031 - DANGEROUS_NODE_MODULES
YN0032 - NODE_GYP_INJECTED
YN0046 - AUTOMERGE_FAILED_TO_PARSE
YN0047 - AUTOMERGE_IMMUTABLE
YN0048 - AUTOMERGE_SUCCESS
YN0049 - AUTOMERGE_REQUIRED
YN0050 - DEPRECATED_CLI_SETTINGS
YN0059 - INVALID_RANGE_PEER_DEPENDENCY
YN0060 - INCOMPATIBLE_PEER_DEPENDENCY
YN0061 - DEPRECATED_PACKAGE
YN0062 - INCOMPATIBLE_OS
YN0063 - INCOMPATIBLE_CPU
YN0068 - UNUSED_PACKAGE_EXTENSION
YN0069 - REDUNDANT_PACKAGE_EXTENSION
YN0071 - NM_CANT_INSTALL_EXTERNAL_SOFT_LINK
YN0072 - NM_PRESERVE_SYMLINKS_REQUIRED
YN0074 - NM_HARDLINKS_MODE_DOWNGRADED
YN0075 - PROLOG_INSTANTIATION_ERROR
YN0076 - INCOMPATIBLE_ARCHITECTURE
YN0077 - GHOST_ARCHITECTURE
</pre>
</details>
<h2 id="yarn-dlx">yarn dlx</h2>
<p>与 npx 类似，是 download and execute 的简称。<br>
只能执行远端的可执行文件。（不能执行本地的可执行文件）</p>
<h2 id="缓存">缓存</h2>
<pre><code>yarn cache list // 列出缓存的文件
yarn cache dir  // 列出缓存目录
yarn cache clean [&lt;module_name&gt;] // 清除缓存
</code></pre>
<p>缓存目录：<code>cache-folder</code></p>
<h2 id="principle">principle</h2>
<p>可基于插件、模块化与作者共同开发 yarn。<br>
yarn 的核心代码：是由不同的内置插件实现的。</p>
<p>如何支持多个编辑器？
为什么要与<code>corepack</code>一起工作？</p>
<h3 id="uml">uml</h3>
<pre><code>
</code></pre>
<h2 id="todo">todo</h2>
<blockquote>
<p>版本迭代后 api 无变化
开发一个插件
未来迭代计划。</p>
</blockquote>

        
        
    </body>
    </html>