<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>2022 &#x5e74;&#x4e86;&#x8fd8;&#x60f3;&#x5f00;&#x53d1;&#x5de5;&#x5177;&#x65b9;&#x6cd5;&#x5305;&#x3002;&#x8d76;&#x7d27;&#x53d6;&#x6d88;&#x8fd9;&#x4e2a;&#x60f3;&#x6cd5;&#x5427;&#x3002;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h2 id="2022-年了还想开发工具方法包赶紧取消这个想法吧">2022 年了还想开发工具方法包。赶紧取消这个想法吧。</h2>
<pre><code class="language-js"><span class="hljs-comment">// 去抖</span>
<span class="hljs-comment">// 一段时间内连续调用，只执行一次。维护一个定时器，在定时器结束时执行。</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">createDebounceFn</span> = (<span class="hljs-params">fn, t = <span class="hljs-number">250</span>, self?: A</span>) =&gt; {
    <span class="hljs-keyword">var</span> timer
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...rest</span>) =&gt;</span> {
      <span class="hljs-keyword">var</span> context = self
      <span class="hljs-keyword">if</span> (timer) {
        <span class="hljs-built_in">clearTimeout</span>(timer)
      }
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        fn.<span class="hljs-title function_">apply</span>(context, rest),
        <span class="hljs-comment">// fn.call(context, ...rest),</span>
      }, t)
    }
}
<span class="hljs-comment">// 节流</span>
<span class="hljs-comment">// 一段时间内调用，每隔一段时间执行一次。当大于延迟时执行。</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">createThrottleFn</span> = (<span class="hljs-params">fn, t = <span class="hljs-number">250</span></span>) =&gt; {
    <span class="hljs-keyword">let</span> prev = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...rest</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
        <span class="hljs-keyword">if</span> (now - prev &gt; t) {
            <span class="hljs-title function_">fn</span>(...rest)
            prev = now
        }
    }
}
<span class="hljs-comment">// 解释查询字符串</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">parseUrlQS</span> = (<span class="hljs-params">url = <span class="hljs-variable language_">window</span>.location.href, useCode = <span class="hljs-literal">true</span></span>) =&gt; {
  <span class="hljs-keyword">let</span> index = url.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;?&#x27;</span>)
  <span class="hljs-keyword">let</span> qs = url.<span class="hljs-title function_">slice</span>(index)
  qs = qs.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">if</span> (qs) {
    <span class="hljs-keyword">let</span> res = qs.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&amp;&#x27;</span>) <span class="hljs-comment">// [k=v, ...]</span>
      .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">r, c</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> [k, v] = c.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>)
        <span class="hljs-keyword">if</span> (useCode) {
          v = <span class="hljs-built_in">decodeURIComponent</span>(v)
        }
        r[k] = v
        <span class="hljs-keyword">return</span> r
      }, {})
    <span class="hljs-keyword">return</span> res
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> {}
  }
}
<span class="hljs-comment">// 获取数据类型</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">getType</span> = (<span class="hljs-params">o</span>) =&gt; <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(o).<span class="hljs-title function_">slice</span>(<span class="hljs-number">8</span>, -<span class="hljs-number">1</span>) <span class="hljs-comment">// 返回构造函数的名字 大写开头</span>
<span class="hljs-comment">// 输出</span>
<span class="hljs-keyword">let</span> clog = <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">j</span> = (<span class="hljs-params">obj?: object</span>) =&gt; (obj === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">undefined</span> : <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj)))
<span class="hljs-keyword">let</span> <span class="hljs-title function_">clogj</span> = (<span class="hljs-params">p</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> p === <span class="hljs-string">&#x27;object&#x27;</span>) {
    <span class="hljs-title function_">clog</span>(<span class="hljs-title function_">j</span>(p))
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">clog</span>(p)
  }
}

<span class="hljs-keyword">let</span> <span class="hljs-title function_">randomNum</span> = (<span class="hljs-params">n = <span class="hljs-number">10000</span></span>) =&gt; (<span class="hljs-title class_">String</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * n)))
<span class="hljs-comment">// 深复制。</span>
<span class="hljs-comment">// 有引用的情况。</span>
<span class="hljs-comment">// 无法处理循环引用</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">cloneDeep</span> = (<span class="hljs-params">v</span>) =&gt; {
  <span class="hljs-keyword">let</span> baseType = [<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-string">&#x27;boolean&#x27;</span>, <span class="hljs-string">&#x27;undefined&#x27;</span>, <span class="hljs-string">&#x27;bigint&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>]
  <span class="hljs-keyword">let</span> res
  <span class="hljs-keyword">if</span> (baseType.<span class="hljs-title function_">includes</span>(<span class="hljs-keyword">typeof</span> v)) {
      res = v
  } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// null array object date set map function</span>
      <span class="hljs-keyword">if</span> (!v) {
          res = v
      } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(v)) {
              res = v.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">cloneDeep</span>(item))
          } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">let</span> t = {}
              <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(v).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> {
                <span class="hljs-keyword">let</span> type = <span class="hljs-title function_">getType</span>(v)
                <span class="hljs-keyword">switch</span> (type) {
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Function&#x27;</span>:
                    t[k] = v
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Set&#x27;</span>:
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(v).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
                      <span class="hljs-keyword">return</span> <span class="hljs-title function_">cloneDeep</span>(item)
                    }))
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Map&#x27;</span>:
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(v).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> ([<span class="hljs-title function_">cloneDeep</span>(k), <span class="hljs-title function_">cloneDeep</span>(v)])))
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Date&#x27;</span>:
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(v)
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Object&#x27;</span>:
                    t[k] = <span class="hljs-title function_">cloneDeep</span>(v)
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;RegExp&#x27;</span>: <span class="hljs-comment">// 未测试</span>
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(v.<span class="hljs-property">source</span>, v.<span class="hljs-property">flags</span>)
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-attr">default</span>:
                    t[k] = v <span class="hljs-comment">// 当发现新类型里再添加，先用引用处理。</span>
                    <span class="hljs-keyword">break</span>;
                }
              })
              res = t
          }
      }
  }
  <span class="hljs-keyword">return</span> res
}
<span class="hljs-keyword">let</span> cloneDeepTs = (<span class="hljs-attr">v</span>: A): <span class="hljs-function"><span class="hljs-params">A</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> baseType = [<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-string">&#x27;boolean&#x27;</span>, <span class="hljs-string">&#x27;undefined&#x27;</span>, <span class="hljs-string">&#x27;bigint&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>]
  <span class="hljs-keyword">let</span> res
  <span class="hljs-keyword">if</span> (baseType.<span class="hljs-title function_">includes</span>(<span class="hljs-keyword">typeof</span> v)) {
      res = v
  } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// null array object date set map function</span>
      <span class="hljs-keyword">if</span> (!v) {
          res = v
      } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(v)) {
              res = v.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item: A</span>) =&gt;</span> <span class="hljs-title function_">cloneDeep</span>(item))
          } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">let</span> <span class="hljs-attr">t</span>: A = {}
              <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(v).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> {
                <span class="hljs-keyword">let</span> type = <span class="hljs-title function_">getType</span>(v)
                <span class="hljs-keyword">switch</span> (type) {
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Function&#x27;</span>:
                    t[k] = v
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Set&#x27;</span>:
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(v <span class="hljs-keyword">as</span> <span class="hljs-title class_">Set</span>&lt;A&gt;).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
                      <span class="hljs-keyword">return</span> <span class="hljs-title function_">cloneDeep</span>(item)
                    }))
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Map&#x27;</span>:
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(v <span class="hljs-keyword">as</span> <span class="hljs-title class_">Map</span>&lt;A, A&gt;).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> ([<span class="hljs-title function_">cloneDeep</span>(k), <span class="hljs-title function_">cloneDeep</span>(v)])))
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Date&#x27;</span>:
                    t[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(v <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> <span class="hljs-title class_">Date</span>)
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Object&#x27;</span>:
                    t[k] = <span class="hljs-title function_">cloneDeep</span>(v)
                    <span class="hljs-keyword">break</span>;
                  <span class="hljs-attr">default</span>:
                    t[k] = v <span class="hljs-comment">// 当发现新类型里再添加，先用引用处理。</span>
                    <span class="hljs-keyword">break</span>;
                }
              })
              res = t
          }
      }
  }
  <span class="hljs-keyword">return</span> res
}
<span class="hljs-keyword">let</span> <span class="hljs-title function_">cloneDeep</span> = (<span class="hljs-params">v: A</span>) =&gt; {
  <span class="hljs-keyword">let</span> baseType = [<span class="hljs-string">&#x27;string&#x27;</span>, <span class="hljs-string">&#x27;number&#x27;</span>, <span class="hljs-string">&#x27;boolean&#x27;</span>, <span class="hljs-string">&#x27;undefined&#x27;</span>, <span class="hljs-string">&#x27;bigint&#x27;</span>, <span class="hljs-string">&#x27;symbol&#x27;</span>]
  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: A
  <span class="hljs-keyword">if</span> (baseType.<span class="hljs-title function_">includes</span>(<span class="hljs-keyword">typeof</span> v)) {
      res = v
  } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// null array object</span>
      <span class="hljs-keyword">if</span> (!v) {
          res = v
      } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(v)) {
              res = v.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">cloneDeep</span>(item))
          } <span class="hljs-keyword">else</span> {
              <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(v).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> {
                  res[k] = <span class="hljs-title function_">cloneDeep</span>(v)
              })
          }
      }
  }
  <span class="hljs-keyword">return</span> res
}
<span class="hljs-comment">// promise封装ajax</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">fetchData</span> = (<span class="hljs-params">url, method</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s, j</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>()
    client.<span class="hljs-title function_">open</span>(method.<span class="hljs-title function_">toUpperCase</span>(), url)
    client.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">readyState</span> !== <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">return</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
          <span class="hljs-title function_">s</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">response</span>)
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">j</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">statusText</span>))
        }
      }
    }
    client.<span class="hljs-property">responseType</span> = <span class="hljs-string">&#x27;json&#x27;</span>
    client.<span class="hljs-title function_">setRequstHeader</span>(<span class="hljs-string">&#x27;Accept&#x27;</span>, <span class="hljs-string">&#x27;application/json&#x27;</span>)
    client.<span class="hljs-title function_">send</span>()
  })
}
<span class="hljs-comment">// 判断是否是promise对象</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">isPromise</span> = (<span class="hljs-params">obj</span>) =&gt; (<span class="hljs-keyword">typeof</span> obj.<span class="hljs-property">then</span> === <span class="hljs-string">&#x27;function&#x27;</span>)
<span class="hljs-comment">// 开关机</span>
<span class="hljs-keyword">function</span> * <span class="hljs-title function_">genSwitch</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">let</span> t = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">yield</span> t = !t
    }
}
<span class="hljs-comment">// 生成fibonacci数列</span>
<span class="hljs-keyword">function</span> * <span class="hljs-title function_">getFibonacci</span>(<span class="hljs-params">num = <span class="hljs-number">10</span></span>) {
    <span class="hljs-keyword">let</span> t = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> [pre, cur] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
    <span class="hljs-keyword">while</span> (t++ &lt; num) {
        <span class="hljs-keyword">yield</span> cur
        <span class="hljs-keyword">let</span> q = cur
        cur = q + pre
        pre = q
    }
}
<span class="hljs-comment">// 阻止事件</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">preventEvent</span> = (<span class="hljs-params">e, option = {isStop: <span class="hljs-literal">true</span>, isPrevent: <span class="hljs-literal">true</span>}</span>) =&gt; {
  option.<span class="hljs-property">isStop</span> &amp;&amp; e.<span class="hljs-title function_">stopPropagation</span>() <span class="hljs-comment">// 阻止冒泡</span>
  option.<span class="hljs-property">isPrevent</span> &amp;&amp; e.<span class="hljs-title function_">preventDefault</span>() <span class="hljs-comment">// 阻止默认事件</span>
}
<span class="hljs-comment">// 转义HTML标签的方法</span>
<span class="hljs-keyword">let</span> funEncodeHTML = <span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str == <span class="hljs-string">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;|&amp;|&gt;/g</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">matches</span>) {
            <span class="hljs-keyword">return</span> ({
                <span class="hljs-string">&#x27;&lt;&#x27;</span>: <span class="hljs-string">&#x27;&amp;lt;&#x27;</span>,
                <span class="hljs-string">&#x27;&gt;&#x27;</span>: <span class="hljs-string">&#x27;&amp;gt;&#x27;</span>,
                <span class="hljs-string">&#x27;&amp;&#x27;</span>: <span class="hljs-string">&#x27;&amp;amp;&#x27;</span>
            })[matches];
        });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;
};
<span class="hljs-comment">// 反转义HTML标签的方法</span>
<span class="hljs-keyword">let</span> funDecodeHTML = <span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str == <span class="hljs-string">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&amp;lt;|&amp;gt;|&amp;amp;/g</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">matches</span>) {
            <span class="hljs-keyword">return</span> ({
                <span class="hljs-string">&#x27;&amp;lt;&#x27;</span>: <span class="hljs-string">&#x27;&lt;&#x27;</span>,
                <span class="hljs-string">&#x27;&amp;gt;&#x27;</span>: <span class="hljs-string">&#x27;&gt;&#x27;</span>,
                <span class="hljs-string">&#x27;&amp;amp;&#x27;</span>: <span class="hljs-string">&#x27;&amp;&#x27;</span>
            })[matches];
        });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;
};
<span class="hljs-comment">// 回调方法转换为promise</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">cbToP</span> = (<span class="hljs-params">fn, ...params</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s, j</span>) =&gt;</span> {
    <span class="hljs-title function_">fn</span>(...params, <span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> err ? <span class="hljs-title function_">j</span>(err) : <span class="hljs-title function_">s</span>(res)
    })
})
<span class="hljs-keyword">let</span> callbackToPromise = cbToP

<span class="hljs-comment">// 把setTimeout封装为Promise</span>
<span class="hljs-comment">// 考虑一下要不要做成像 Proxy Proxy.revocable 一样，分别控制不可取消与可取消。</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">setTimeoutPromise</span> = (<span class="hljs-params">cb: () =&gt; {}, delay: <span class="hljs-number">0</span></span>) =&gt; {
  <span class="hljs-comment">// return new Promise((s) =&gt; {</span>
  <span class="hljs-comment">//   setTimeout(() =&gt; {s(cb())}, delay)</span>
  <span class="hljs-comment">// })</span>
  <span class="hljs-keyword">let</span> timeoutId
  <span class="hljs-keyword">let</span> timeout = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> {
    timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">s</span>(<span class="hljs-title function_">cb</span>())
    }, delay)
  })
  <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> timeoutId &amp;&amp; <span class="hljs-built_in">clearTimeout</span>(timeoutId)
  <span class="hljs-keyword">return</span> {timeout, cancel}
}

<span class="hljs-comment">// 指定时长后再执行</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">sleep</span> = (<span class="hljs-params">delay</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(s, delay)
  })
}

<span class="hljs-comment">// 达到最大时长时，返回默认值</span>
<span class="hljs-comment">// 也可处理为高阶函数</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">timeoutValue</span> = (<span class="hljs-params">realPromiseFn, delay, defalutValue</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>([<span class="hljs-title function_">realPromiseFn</span>(), setTimeoutPromise(<span class="hljs-function">() =&gt;</span> defaultValue, delay)])
}

<span class="hljs-comment">// 复制</span>
<span class="hljs-keyword">let</span> copy = <span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>){
  <span class="hljs-keyword">var</span> inp = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;input&#x27;</span>); <span class="hljs-comment">// create input标签</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(inp) <span class="hljs-comment">// 添加到body中</span>
  inp.<span class="hljs-property">value</span> = str <span class="hljs-comment">// that.textContent // 给input设置value属性为需要copy的内容</span>
  inp.<span class="hljs-title function_">select</span>(); <span class="hljs-comment">// 选中</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">&#x27;copy&#x27;</span>,<span class="hljs-literal">false</span>); <span class="hljs-comment">// copy已经选中的内容</span>
  inp.<span class="hljs-title function_">remove</span>(); <span class="hljs-comment">// 删除掉这个dom</span>
}
<span class="hljs-comment">// 创建方法</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">createFunction</span> = (<span class="hljs-params">...args, body</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(...args, body)
}
<span class="hljs-comment">// 职责链 见“设计模式”</span>
<span class="hljs-comment">// xx</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">walk</span> (instance) {
  <span class="hljs-title function_">doWork</span>(instance)
  <span class="hljs-keyword">let</span> children = instance.<span class="hljs-title function_">render</span>()
  children.<span class="hljs-title function_">forEach</span>(walk)
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">doWork</span> () {
  ...
}
<span class="hljs-comment">// walk(obj)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">j</span> (obj) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj))
}
<span class="hljs-comment">// 把一个数字表示为2的若干次方相加之和</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">basis2</span> = (<span class="hljs-params">n</span>) =&gt; {
  <span class="hljs-keyword">let</span> res = []
  <span class="hljs-keyword">let</span> s = n.<span class="hljs-title function_">toString</span>(<span class="hljs-number">2</span>)
  s.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item === <span class="hljs-string">&#x27;1&#x27;</span>) {
      res.<span class="hljs-title function_">push</span>(index)
    }
  })
  <span class="hljs-keyword">return</span> res
}
<span class="hljs-comment">// 最大公约数</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">gcd</span> = (<span class="hljs-params">n, m</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!m) {
    <span class="hljs-keyword">return</span> n
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">gcd</span>(m, n % m)
    }
}
<span class="hljs-comment">// 最小公倍数</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">lcm</span> = (<span class="hljs-params">a, b</span>) =&gt; {
  <span class="hljs-keyword">return</span> a * b / <span class="hljs-title function_">gcd</span>(a, b)
}
<span class="hljs-comment">// 最大并行数量promise</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">parallelMaxPromise</span> = (<span class="hljs-params">cb = <span class="hljs-built_in">Promise</span>.resolve(), capacity = <span class="hljs-number">3</span>, material = []</span>) =&gt; {
  <span class="hljs-keyword">let</span> mi = <span class="hljs-number">0</span>
  <span class="hljs-keyword">let</span> pendingCount = capacity
  <span class="hljs-keyword">let</span> <span class="hljs-title function_">createP</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">cb</span>(material[mi]))
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      pendingCount--
      <span class="hljs-title function_">check</span>()
    })
  }
  <span class="hljs-keyword">let</span> <span class="hljs-title function_">check</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">if</span> (pendingCount &lt; capacity &amp;&amp; mi &lt; material.<span class="hljs-property">length</span>) {
      <span class="hljs-title function_">createP</span>()
      mi++
    }
  }
  <span class="hljs-keyword">if</span> (material.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; capacity; i++) {
      <span class="hljs-title function_">createP</span>()
      mi++
    }
  }
}
<span class="hljs-comment">// 创建一个worker</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWorker</span>(<span class="hljs-params">f</span>) {
  <span class="hljs-keyword">var</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">&#x27;(&#x27;</span> + f.<span class="hljs-title function_">toString</span>() +<span class="hljs-string">&#x27;)()&#x27;</span>]);
  <span class="hljs-keyword">var</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
  <span class="hljs-keyword">var</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(url);
  <span class="hljs-keyword">return</span> worker;
}
<span class="hljs-comment">// 可控制状态的promise对象</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> createDefer&lt;T = any&gt;(): <span class="hljs-title class_">Defer</span>&lt;T&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">r</span>: any = {};
  <span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    r.<span class="hljs-property">resolve</span> = resolve;
    r.<span class="hljs-property">reject</span> = reject;
  });
  r.<span class="hljs-property">promise</span> = <span class="hljs-function">() =&gt;</span> promise;
  <span class="hljs-keyword">return</span> r;
}

<span class="hljs-keyword">let</span> clog = <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>
<span class="hljs-keyword">let</span> helper = {
  <span class="hljs-attr">deepClone</span>: <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p <span class="hljs-comment">// todo</span>
}
<span class="hljs-keyword">let</span> <span class="hljs-title function_">mockUlid</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100000</span>)
}
<span class="hljs-keyword">let</span> ulid = mockUlid
<span class="hljs-comment">// 创建一个空间，用于容纳数据。</span>
<span class="hljs-comment">// 创建若干索引表，每条索引指向若干数据。</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MySql</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">indexField = [<span class="hljs-string">&#x27;id&#x27;</span>], schema = {},
<span class="hljs-comment">// spaceSize = &#x27;500k&#x27;</span>
  </span>) {
    <span class="hljs-comment">// 预检</span>
    <span class="hljs-comment">// 设置实例属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">space</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexTableBox</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-comment">// this._indexFieldList = Array.isArray(indexField) ? indexField : [indexField]</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexFieldSet</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_schema</span> = schema
    <span class="hljs-comment">// this.genIndexTableMap()</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>(indexField)
  }
  <span class="hljs-title function_">init</span>(<span class="hljs-params">indexField</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFieldSet</span>(indexField)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">genIndexTableMap</span>(indexField)
  }
  <span class="hljs-title function_">getFieldSet</span>(<span class="hljs-params">indexField</span>) {
    indexField.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexFieldSet</span>.<span class="hljs-title function_">add</span>(item)
    })
  }
  <span class="hljs-comment">// Init 若干索引表</span>
  <span class="hljs-title function_">genIndexTableMap</span>(<span class="hljs-params">indexField</span>) {
    indexField.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">indexKey</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexTableBox</span>.<span class="hljs-title function_">set</span>(indexKey, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>())
    })
  }
  <span class="hljs-title function_">recastIndexTable</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// this.genIndexTable()</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexTableBox</span> = {}
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">space</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>(element)
    })
  }
  <span class="hljs-title function_">add</span>(<span class="hljs-params">p</span>) {
    <span class="hljs-comment">// object</span>
    <span class="hljs-comment">// number</span>
    <span class="hljs-comment">// string</span>
    <span class="hljs-comment">// array</span>
    <span class="hljs-comment">// regexp</span>
    <span class="hljs-comment">// date</span>
    <span class="hljs-keyword">let</span> ulid = <span class="hljs-title function_">mockUlid</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">space</span>.<span class="hljs-title function_">set</span>(ulid, helper.<span class="hljs-title function_">deepClone</span>(p))
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(p)).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexFieldSet</span>.<span class="hljs-title function_">has</span>(key)) {
        <span class="hljs-keyword">let</span> value = p[key]
        <span class="hljs-keyword">let</span> indexTable = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexTableBox</span>.<span class="hljs-title function_">get</span>(key)
        <span class="hljs-keyword">let</span> ulidList = indexTable.<span class="hljs-title function_">get</span>(value)
        <span class="hljs-keyword">if</span> (ulidList) {
          ulidList.<span class="hljs-title function_">push</span>(ulid)
        } <span class="hljs-keyword">else</span> {
          indexTable.<span class="hljs-title function_">set</span>(value, [ulid])
        }
      }
    })
  }
  <span class="hljs-title function_">get</span>(<span class="hljs-params">key, value</span>) {
    <span class="hljs-comment">// return this._indexTableBox.get(key).get(value)</span>
    <span class="hljs-comment">// 预检</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexFieldSet</span>.<span class="hljs-title function_">has</span>(key)) {
      <span class="hljs-comment">// 查询</span>
      <span class="hljs-keyword">let</span> ulidList = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexTableBox</span>.<span class="hljs-title function_">get</span>(key).<span class="hljs-title function_">get</span>(value)
      <span class="hljs-keyword">let</span> res = []
      <span class="hljs-keyword">if</span> (ulidList) {
        ulidList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">ulid</span> =&gt;</span> {
          res.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">space</span>.<span class="hljs-title function_">get</span>(ulid))
        })
      }
      <span class="hljs-keyword">return</span> res
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`此<span class="hljs-subst">${key}</span>不是索引，不能做查询。`</span>)
    }
  }
  <span class="hljs-title function_">delete</span>(<span class="hljs-params">key, value</span>) {
    <span class="hljs-keyword">let</span> indexTable = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_indexTableBox</span>.<span class="hljs-title function_">get</span>(key)
    <span class="hljs-keyword">let</span> ulidList = indexTable.<span class="hljs-title function_">get</span>(value)
    <span class="hljs-comment">// let remainUlid = [...ulidList]</span>
    (ulidList || []).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">ulid</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">space</span>.<span class="hljs-title function_">delete</span>(ulid)
    })
    indexTable.<span class="hljs-title function_">set</span>(value, [])
  }
  <span class="hljs-comment">// 没有改</span>
  <span class="hljs-comment">// set(key, value) {}</span>
}
<span class="hljs-comment">// export default MySql;</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">MySql</span> = <span class="hljs-title class_">MySql</span>

<span class="hljs-comment">// 可控制的promise</span>
<span class="hljs-comment">// 只能用一次。若想用多次请使用rxjs</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ControlablePromise</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">promise</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s, j</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolve</span> = s
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reject</span> = j
    })
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolve</span> = <span class="hljs-function">() =&gt;</span> {}
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reject</span> = <span class="hljs-function">() =&gt;</span> {}
  }
}
<span class="hljs-comment">// 去空</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">delEmpty</span> = (<span class="hljs-params">str: S</span>) =&gt; {
  <span class="hljs-keyword">let</span> res = <span class="hljs-string">&#x27;&#x27;</span>
  <span class="hljs-keyword">switch</span>(<span class="hljs-title function_">getType</span>(str)) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;String&#x27;</span>:
      <span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/\s*/g</span>
      res = str.<span class="hljs-title function_">replace</span>(reg, <span class="hljs-string">&#x27;&#x27;</span>)
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      res = <span class="hljs-string">&#x27;&#x27;</span>
      <span class="hljs-keyword">break</span>;
  }
  <span class="hljs-keyword">return</span> res
}
<span class="hljs-keyword">let</span> errorCode = {
  <span class="hljs-number">0</span>: <span class="hljs-string">&#x27;成功&#x27;</span>,
  <span class="hljs-number">100100</span>: <span class="hljs-string">&#x27;未传递必传参数&#x27;</span>, <span class="hljs-comment">// 要求字段必传</span>
  <span class="hljs-number">200000</span>: <span class="hljs-string">&#x27;保存数据时出错&#x27;</span>,
  <span class="hljs-number">300000</span>: <span class="hljs-string">&#x27;无对应数据&#x27;</span>,
  <span class="hljs-comment">// ...</span>
}
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// step 0</span>
  <span class="hljs-comment">// .then(() =&gt; {...})</span>
  <span class="hljs-comment">// .catch(() =&gt; {return Promise.reject(100100)})</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// step 1</span>
  <span class="hljs-comment">// .then(() =&gt; {...})</span>
  <span class="hljs-comment">// .catch(() =&gt; {return Promise.reject(200000)})</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// step 2</span>
  <span class="hljs-comment">// .then(() =&gt; {...})</span>
  <span class="hljs-comment">// .catch(() =&gt; {return Promise.reject(300000)})</span>
}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
    code,
    <span class="hljs-attr">message</span>: errorCode[code],
    <span class="hljs-attr">data</span>: {}
  })
})
<span class="hljs-comment">// 格式化json字符串</span>
<span class="hljs-comment">// 未测试</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">formatJson</span> = (<span class="hljs-params">a: object | string, indent = <span class="hljs-number">2</span></span>) =&gt; {
  <span class="hljs-keyword">let</span> ot = a
  <span class="hljs-keyword">switch</span>(<span class="hljs-title function_">getType</span>(ot)) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;String&#x27;</span>:
      ot = ot.<span class="hljs-title function_">trim</span>()
      ot = ot.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^[&#x27;&quot;]{/</span>, <span class="hljs-string">&#x27;{&#x27;</span>)
      ot = ot.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/}[&#x27;&quot;]$/</span>, <span class="hljs-string">&#x27;}&#x27;</span>)
      ot = ot.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\&quot;/g</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>)
      ot = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(ot)
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Object&#x27;</span>:
      <span class="hljs-keyword">break</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(ot, <span class="hljs-function">(<span class="hljs-params">_k, v</span>) =&gt;</span> v, indent)
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">djb2HashFn</span>: <span class="hljs-title class_">HashFn</span> = <span class="hljs-function">(<span class="hljs-params">k: A</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> h = <span class="hljs-number">5381</span>  <span class="hljs-keyword">let</span> t = <span class="hljs-title class_">String</span>(k)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; t.<span class="hljs-property">length</span>; i++) {
      h = h * <span class="hljs-number">33</span> + t.<span class="hljs-title function_">charCodeAt</span>(i)
    }
    <span class="hljs-keyword">return</span> h % <span class="hljs-number">1013</span>
}
<span class="hljs-keyword">let</span> <span class="hljs-attr">loseloseHashFn</span>: <span class="hljs-title class_">HashFn</span> = <span class="hljs-function">(<span class="hljs-params">k: A</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> h = <span class="hljs-number">0</span>  <span class="hljs-keyword">let</span> t = <span class="hljs-title class_">String</span>(k)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; t.<span class="hljs-property">length</span>; i++) {
    h = h + t.<span class="hljs-title function_">charCodeAt</span>(i)
  }
  <span class="hljs-keyword">return</span> h % <span class="hljs-number">37</span>
}
<span class="hljs-keyword">let</span> <span class="hljs-title function_">microAsync</span> = (<span class="hljs-params">cb: F, delay = <span class="hljs-number">0</span>, ...p: A[]</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s, _j</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">s</span>(<span class="hljs-literal">true</span>)
    }, delay)
  }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(...p)
  })
}
<span class="hljs-keyword">let</span> <span class="hljs-title function_">cutTail</span> = (<span class="hljs-params">str, threshold = <span class="hljs-number">18</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> str.<span class="hljs-property">length</span> &gt; threshold ? <span class="hljs-string">`<span class="hljs-subst">${str.slice(<span class="hljs-number">0</span>, threshold)}</span>...`</span> : str
}
<span class="hljs-keyword">let</span> <span class="hljs-title function_">cutLength</span> = (<span class="hljs-params">str, pre = <span class="hljs-number">4</span>, post = <span class="hljs-number">6</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (str) {
    <span class="hljs-keyword">if</span> (pre + post &lt; str.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${str.slice(<span class="hljs-number">0</span>, pre)}</span>...<span class="hljs-subst">${str.slice(-post)}</span>`</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> str旧上过不是刉jmh6
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> str
  }
}
<span class="hljs-comment">// 兼容的数组，常用于处理脏数据。</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">compatibleArray</span> = (<span class="hljs-params">a</span>) =&gt; <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(a) ? <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(a) : []
<span class="hljs-comment">// 轮询promise</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">sleep</span> = (<span class="hljs-params">n: N = <span class="hljs-number">0</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {<span class="hljs-title function_">s</span>(<span class="hljs-literal">true</span>)}, n)
  })
}
<span class="hljs-comment">// todo 迁移到web-stone</span>
<span class="hljs-keyword">let</span> loopPropotype = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>({}, {
  <span class="hljs-attr">launch</span>: {
    <span class="hljs-attr">value</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">...p: A[]</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pFn</span>(...p).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r: A</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bFn</span>(r)) { <span class="hljs-comment">// 若满足条件则继承，否则返回结果。</span>
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">launch</span>(...p)
          })
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> r
        }
      })
    }
  }
})
<span class="hljs-keyword">let</span> createLoop = (<span class="hljs-attr">pFn</span>: F, <span class="hljs-attr">bFn</span>: F, <span class="hljs-attr">i</span>: N = <span class="hljs-number">0</span>): <span class="hljs-function"><span class="hljs-params">CreateLoop</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(loopPropotype, {
    <span class="hljs-attr">pFn</span>: {
      <span class="hljs-attr">value</span>: pFn
    },
    <span class="hljs-attr">bFn</span>: {
      <span class="hljs-attr">value</span>: bFn
    },
    <span class="hljs-attr">interval</span>: {
      <span class="hljs-attr">value</span>: i
    },
  })
}

















</code></pre>
<ul>
<li><a href="/util/rxjs.html">rxjs</a></li>
<li><a href="/language/javascript/json-transfer.html">转换 JSON</a></li>
<li><a href="/util/axios.html">axios 项目中使用工具方法</a></li>
<li><a href="/util/statistics.html">统计学 statistics 常用的方法</a></li>
<li><a href="/util/title.html">title</a></li>
<li><a href="/util/title.html">title</a></li>
<li><a href="/util/title.html">title</a></li>
<li><a href="/util/title.html">title</a></li>
<li><a href="/util/title.html">title</a></li>
<li><a href="/util/title.html">title</a></li>
</ul>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>