<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      let clog = console.log
      class Observable {
        constructor(o) {
          this.proxyObj = new Proxy(o, {
            get: (target, key, receiver) => {
              return target[key]
            },
            set: (target, key, value, receiver) => {
              target[key] = value
              this.observerList.forEach((v, k) => {
                console.log(v, k)
                k(target)
              })
              return true
            },
          })
          this.observerList = new Map()
        }
        addObserver(fn) {
          this.observerList.set(fn, Symbol())
        }
        removeObserver(fn) {
          this.observerList.delete(fn)
        }
        set(k, v) {
          this.proxyObj[k] = v
        }
        get(k) {
          return this.proxyObj[k]
        }
      }
      let origin = {}
      let o = new Observable(origin)
      let a = (p) => {
        clog('a fn', p)
      }
      let b = (p) => {
        clog('b fn', p)
      }
      o.addObserver(a)
      o.addObserver(b)
      o.set('k', 'v')
      o.set('k1', 'v1')
      clog(o.get('k'))
    </script>
  </body>
</html>
