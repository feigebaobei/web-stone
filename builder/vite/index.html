<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>vite</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="vite">vite</h1>
<h2 id="overview">overview</h2>
<blockquote>
<p>是一个开发时服务器，它基于 原生 ES 模块 提供了 丰富的内建功能，
基于 rollup 提供打包功能，vite 插件也就是被 rollup 使用的。
基于 rollup 提供插件功能。
以 esm 规范提供代码。然后由浏览器处理。
套构建指令，它使用 Rollup 打包你的代码，并且它是预配置的，可输出用于生产环境的高度优化过的静态资源。
强大的导入功能。
需要与支持 esm 语法的浏览器配合工作。
node v14.18.0+<br>
它是一个工具集。把一些常用的工具放在一起了。（像不像门面模式）构建功能大部分是基于 rollup(esbuild)的。而且面向现代浏览器。<br>
它运行的快，原来是因为基于 esbuild、做了很少工作、面向现代浏览。能不干的事儿，全不干了。</p>
</blockquote>
<h3 id="feature">feature</h3>
<ul>
<li>开发服务器</li>
<li>构建命令</li>
<li>默认以<code>&lt;root&gt;/index.html</code>为主入口。</li>
<li>在 index.html 中以<code>&lt;script type=&quot;module&quot; src=&quot;...&quot; /&gt;</code>和<code>&lt;link href=&quot;...&quot;&gt;</code>处理 js/css。vite 会处理 js/css 的引入工作。</li>
<li>可以实现多入口（即多页面）。</li>
<li>使用 Vite 开发和使用一个静态文件服务器并没有太大区别。然而，Vite 还通过原生 ESM 导入提供了许多主要用于打包场景的增强功能。</li>
<li>内部使用 esbuild 把要 cjs/umd 转换为 esm（该过程叫预构建）。</li>
<li>由 esbuild ts=&gt;js</li>
<li>支持 ts</li>
<li>支持 hmr</li>
<li></li>
</ul>
<h2 id="install">install</h2>
<p>一般不用明确安装。<br>
<code>npm i vite -g</code></p>
<h2 id="usage">usage</h2>
<pre><code class="language-shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">初始化一个项目</span>
npm init vite@latest
npm create vite@latest # cteate 是 init 的别名
yarn create vite
pnpm create vite
<span class="hljs-meta prompt_"># </span><span class="language-bash">然后会提示选择什么模板。</span>
</code></pre>
<h2 id="功能">功能</h2>
<ul>
<li>提供一个类似静态文件服务器的功能。</li>
<li>vite 对原生 esm 导入做了很多增强功能。
<ul>
<li>使用 esbuild 完成预构建（cjs/umd =&gt; esm）</li>
<li>重写导入为合法 url</li>
<li>依赖是强缓存的。</li>
</ul>
</li>
<li>内置支持 ts。不做类型检查。</li>
<li>esbuild 做了
<ul>
<li>jsx / tsx</li>
<li>预构建（cjs/umd =&gt; esm）</li>
</ul>
</li>
<li>hmr</li>
<li>使用 esbuild 完成 ts=&gt;js
<ul>
<li>tsconfig.json
<ul>
<li>isolatedModules: true</li>
<li>useDefineForClassFields: true</li>
</ul>
</li>
</ul>
</li>
<li>把<code>*.css</code>放入<code>&lt;style&gt;</code>内。
<ul>
<li>postcss</li>
<li>css modules</li>
<li>css 预处理器</li>
</ul>
</li>
<li>处理静态资源。把相对路径变为可解析的 url.</li>
<li>支持 worker</li>
<li>构建优化
<ul>
<li>css 代码分割</li>
<li>生成预加载指令</li>
<li>优化异步 chunk 加载</li>
</ul>
</li>
</ul>
<h3 id="设置-esbuild-配置项">设置 esbuild 配置项</h3>
<pre><code class="language-js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">esbuild</span>: {
    <span class="hljs-attr">jsxFactory</span>: <span class="hljs-string">&#x27;h&#x27;</span>,
    <span class="hljs-attr">jsxFragment</span>: <span class="hljs-string">&#x27;fragment&#x27;</span>,
  },
})
</code></pre>
<h3 id="css">css</h3>
<ul>
<li>导入的 css 文件会插入到 style 标签中。</li>
<li><code>@import</code>内联和变基</li>
<li>postcss。需要项目中使用<code>postcss.config.js</code>配置文件。应用于已导入的 css.</li>
<li>以<code>.module.css</code>为后缀的 css 文件被认为是 css moudes 文件。</li>
<li>需要安装预处理器</li>
<li>禁用 css 注入页面<code>import styles from './foo.css?inline'</code></li>
<li>导入静态资源<code>import imgUrl from './img.png'; document.querySelect(#id).src = imgUrl;</code></li>
<li>导入 json<code>import json from './foo.json</code></li>
<li>
<h2 id="glob-导入-importmetaglobparams">glob 导入 <code>import.meta.glob(params)</code></h2>
</li>
</ul>
<pre><code class="language-js"><span class="hljs-comment">// 懒加载，动态导入实现。</span>
<span class="hljs-keyword">const</span> modules = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>)
=&gt;
<span class="hljs-keyword">const</span> modules = {
    <span class="hljs-comment">// 以路径为key，值是返回Promise的方法</span>
    <span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>),
    <span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>)
}
<span class="hljs-comment">// 使用modules对象的key访问相应的模块</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> path <span class="hljs-keyword">in</span> modules) {
    modules[path]().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">mod</span>) =&gt;</span> {...})
}
<span class="hljs-comment">// 导入所有模块</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>, {<span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span>})
=&gt;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> __glob__0_0 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> __glob__0_1 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>
<span class="hljs-keyword">const</span> m = {
    <span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>: __glob__0_0,
    <span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>: __glob__0_1,
}
<span class="hljs-comment">// 以字符串形式导入资源</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>, {<span class="hljs-keyword">as</span> : <span class="hljs-string">&#x27;raw&#x27;</span>})
=&gt;
<span class="hljs-keyword">const</span> m = {
    <span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>: <span class="hljs-string">&#x27;export default &quot;foo&quot;\n&#x27;</span>,
    <span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>: <span class="hljs-string">&#x27;export default &quot;bar&quot;\n&#x27;</span>
}
<span class="hljs-comment">// 若as: &#x27;url&#x27;，则把资源作为url加载。</span>
<span class="hljs-comment">// 多个匹配</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>([<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>, <span class="hljs-string">&#x27;./a/*.js&#x27;</span>])
<span class="hljs-comment">// 排除</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>([<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>, <span class="hljs-string">&#x27;!**/bar.js&#x27;</span>])
<span class="hljs-comment">// 具名导入</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>, {<span class="hljs-attr">import</span>: <span class="hljs-string">&#x27;setup&#x27;</span>})
=&gt;
<span class="hljs-keyword">const</span> m = {
    <span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">setup</span>),
    <span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">setup</span>)
}
<span class="hljs-comment">// import: &#x27;setup&#x27;, eager: true 会执行tree-shaking</span>
<span class="hljs-comment">// import: &#x27;default&#x27; 会加载默认导出</span>
<span class="hljs-comment">// 自定义查询</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">&#x27;./dir/*.js&#x27;</span>, {
    <span class="hljs-attr">query</span>: {<span class="hljs-attr">foo</span>: <span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-attr">bar</span>: <span class="hljs-literal">true</span>}
})
=&gt;
<span class="hljs-keyword">const</span> m = {
    <span class="hljs-string">&#x27;./dir/foo.js&#x27;</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;./dir/foo.js?foo=bar&amp;bar=true&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">setup</span>) <span class="hljs-comment">// 没有使用具名导入。为什么只导入setup呢？</span>
    <span class="hljs-string">&#x27;./dir/bar.js&#x27;</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;./dir/bar.js?foo=bar&amp;bar=true&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">setup</span>) <span class="hljs-comment">// 没有使用具名导入。为什么只导入setup呢？</span>
}
<span class="hljs-comment">// 动态导入</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">await</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">`./dir/<span class="hljs-subst">${file}</span>.js`</span>)
</code></pre>
<h3 id="web-worker">web worker</h3>
<pre><code class="language-js"><span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;./worker.js&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;./worker.js&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>), {
  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;module&#x27;</span>,
})
<span class="hljs-comment">// worker 脚本将在生产构建中编译成单独的 chunk。</span>
<span class="hljs-comment">// 可以在导入请求上添加 ?worker 或 ?sharedworker 查询参数来直接导入一个 web worker 脚本。</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyWorker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./worker?worker&#x27;</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWorker</span>()
<span class="hljs-comment">// 想将 worker 内联为 base64 字符串，请添加 inline 查询参数：</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyWorker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./worker?worker&amp;inline&#x27;</span>
<span class="hljs-comment">// 添加 url 这个 query.会将一个 URL 的形式读取该 worker</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyWorker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./worker?worker&amp;url&#x27;</span>
</code></pre>
<h3 id="异步-chunk-加载优化">异步 Chunk 加载优化</h3>
<p>会把多个 chunk 中共用的 chunk 一起打包。</p>
<h2 id="cli"><a href="/builder/vite/cli.html">cli</a></h2>
<h2 id="插件"><a href="/builder/vite/plugin.html">插件</a></h2>
<h2 id="依赖预构建">依赖预构建</h2>
<p>就是 cjs/umd =&gt; esm 的过程。使用 esbuild 完成。</p>
<ul>
<li>兼容 cjs/umd</li>
<li>把多个 esm 依赖关系的内部模块转换为单个模块。</li>
<li>自动依赖搜寻
<ol>
<li>从缓存中找</li>
<li>从 node_modules 中找</li>
</ol>
</li>
<li>在一库多包中，不打包的依赖项目，分析并预处理依赖项目的依赖列表。可以使用<code>optimizeDeps.include / build.optimizeDeps.include</code>优化。</li>
<li>vite 使用强缓存。<code>max-age=31536000,immutable</code></li>
<li>文件系统缓存。当下列一个改变时重新运行预构建
<ul>
<li>package.json 中的 dependencies</li>
<li>lockfile</li>
<li>vite.config.js</li>
</ul>
</li>
<li></li>
</ul>
<h3 id="缓存">缓存</h3>
<ul>
<li>文件系统缓存。有其一变动，则重新运行构建。
<ul>
<li>锁文件。</li>
<li>补丁文件</li>
<li>vite.config.js</li>
<li>NODE_ENV</li>
</ul>
</li>
<li>浏览器缓存。有其一则不使用缓存。
<ul>
<li>禁用缓存</li>
<li><code>--force</code>选项。</li>
<li>重新载入页面。</li>
</ul>
</li>
</ul>
<h2 id="静态资源">静态资源</h2>
<p>通过在导入时的 url 中设置 qs.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>引入静态资源。</td>
<td>在开发环境使用相对链接。</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>在生产环境使用绝对链接。（从根路径开始）</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>?url</td>
<td>导入一个 url</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>?raw</td>
<td>导入字符串</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>?worker / ?sharedworker</td>
<td>导入为 web worker</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>?inline</td>
<td>导入为 base64 字符串</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="poblic-目录">poblic 目录</h3>
<ul>
<li>不会被源码引用（例如 robots.txt）</li>
<li>必须保持原有文件名（没有经过 hash）</li>
<li>...或者你压根不想引入该资源，只是想得到其 URL。<code>&lt;root&gt;/public</code></li>
</ul>
<h3 id="new-urlurl-importmetaurl">new URL(url, import.meta.url)</h3>
<p>import.meta.url 中 esm 的原生功能。</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> imgUrl = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;./img.png&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">mete</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>
img.<span class="hljs-property">src</span> = imgUrl <span class="hljs-comment">// 使用</span>
</code></pre>
<h2 id="构建生产版本">构建生产版本</h2>
<p>默认入口是<code>&lt;root&gt;/index.html</code>。
vite 是从<code>*.html</code>文件开始打包的。</p>
<h3 id="公共基础路径">公共基础路径</h3>
<p>如果你需要在嵌套的公共路径下部署项目，只需指定 base 配置项。<br>
结果：在 css 中使用 url() / html 文件中的引用 都是基于引配置项的。
以命令行方式设置 base。</p>
<pre><code class="language-shell">vite build --base=/my/public/path/。
</code></pre>
<h3 id="自定义构建">自定义构建</h3>
<pre><code class="language-js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: { <span class="hljs-comment">// 调整低层rollup选项</span>
      <span class="hljs-comment">// https://rollupjs.org/guide/en/#big-list-of-options</span>
    },
    <span class="hljs-attr">watch</span>: {...} <span class="hljs-comment">// 文件变化时重新构建</span>
    <span class="hljs-attr">rollupOptions</span>: { <span class="hljs-comment">// 多入口打包</span>
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">main</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;index.html&#x27;</span>),
        <span class="hljs-attr">nested</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;nested/index.html&#x27;</span>)
      }
    }
    <span class="hljs-attr">lib</span>: { <span class="hljs-comment">// 当这个库要进行发布构建</span>
        <span class="hljs-attr">entry</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;lib/main.js&#x27;</span>),
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;MyLib&#x27;</span>,
        <span class="hljs-comment">// the proper extensions will be added</span>
        <span class="hljs-attr">fileName</span>: <span class="hljs-string">&#x27;my-lib&#x27;</span>
    }
  }
})
</code></pre>
<h2 id="部署静态站点">部署静态站点</h2>
<pre><code>{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;preview&quot;: &quot;vite preview --port 8080&quot;
  }
}
</code></pre>
<h2 id="环境变量"><a href="/builder/vite/env.html">环境变量</a></h2>
<h2 id="服务端渲染">服务端渲染</h2>
<p>示例项目</p>
<ul>
<li><a href="https://github.com/vitejs/vite/tree/main/playground/ssr-vue">vue3</a></li>
<li><a href="https://github.com/vitejs/vite/tree/main/playground/ssr-react">react</a></li>
</ul>
<h2 id="后端集成">后端集成</h2>
<pre><code class="language-js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    <span class="hljs-comment">// 在 outDir 中生成 manifest.json</span>
    <span class="hljs-attr">manifest</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-comment">// 覆盖默认的 .html 入口</span>
      <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;/path/to/main.js&#x27;</span>,
    },
  },
})
</code></pre>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- 如果是在开发环境中 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:5173/@vite/client&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:5173/main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>执行<code>vite build</code>后，会生成 <a href="/browser/manifestJson.html"><code>manifest.json</code></a> 文件</p>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;main.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assets/main.4889e940.js&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;main.js&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;isEntry&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;dynamicImports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;views/foo.js&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;css&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;assets/main.b82dbe22.css&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;assets&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;assets/asset.0ab0f9cd.png&quot;</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;views/foo.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assets/foo.869aea0d.js&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;src&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;views/foo.js&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;isDynamicEntry&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;imports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;_shared.83069a53.js&quot;</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;_shared.83069a53.js&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assets/shared.83069a53.js&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 id="configuration">configuration</h2>
<p>默认配置文件：<code>vite.config.js</code>。<br>
它是被 node.js 使用。</p>
<pre><code class="language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ command, mode, ssrBuild }</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (command === <span class="hljs-string">&#x27;serve&#x27;</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// dev 独有配置</span>
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// command === &#x27;build&#x27;</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// build 独有配置</span>
    }
  }
})
<span class="hljs-comment">// 异步配置 // js中总是优先异步。</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-keyword">async</span> ({ command, mode }) =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">asyncFunction</span>()
  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// vite 配置</span>
  }
})
<span class="hljs-comment">// 可以引用环境变量后使用。</span>
<span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>
</code></pre>
<p>|              | key                            | 说明                                                                                                                                                                                               | 类型                                                                             | 默认值                                          | 其他枚举值   |        |          |
| ------------ | ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- | ----------------------------------------------- | ------------ | ------ | -------- | -------- | --- | --- |
| 共享配置     |                                |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | root                           | 项目根目录                                                                                                                                                                                         | string                                                                           | processs.cwd()                                  |              |        |          |
|              | base                           | 基础路径。（类似 html 中 base 标签）                                                                                                                                                               | string                                                                           | <code>'/'</code>                                           |              |        |          |
|              | mode                           | 模式                                                                                                                                                                                               | string                                                                           | 'development'                                   | 'production' |        |          |
|              | define                         | 定义全局常量替换方式                                                                                                                                                                               |                                                                                  |                                                 |              |        |          |
|              | plugins                        |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | publicDir                      | 静态资源服务的文件夹                                                                                                                                                                               |                                                                                  | 'public'                                        |              |        |          |
|              | cacheDir                       | 存储缓存文件的目录。此目录下会存储预打包的依赖项或 vite 生成的某些缓存文件                                                                                                                         |                                                                                  | 'node_modules/.vite'                            |              |        |          |
|              | resovle.alias                  | 将会被传递到 @rollup/plugin-alias 作为 entries 的选项                                                                                                                                              |                                                                                  |                                                 |              |        |          |
|              | resovle.dedupe                 | 如果你在你的应用程序中有相同依赖的副本（比如 monorepos），请使用此选项强制 Vite 始终将列出的依赖项解析为同一副本（从项目根目录）。                                                                 |                                                                                  |                                                 |              |        |          |
|              | resovle.conditions             |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | resovle.mainFields             | 在解析包的入口点时尝试的字段列表。                                                                                                                                                                 |                                                                                  |                                                 |              |        |          |
|              | resovle.extensions             | 导入时想要省略的扩展名列表。                                                                                                                                                                       |                                                                                  | ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json'] |
|              |                                |                                                                                                                                                                                                    |
|              | resovle.preserveSymlinks       | 是否通过原始文件路径                                                                                                                                                                               |                                                                                  |                                                 |              |        |          |
|              | css.modules                    | 配置 CSS modules 的行为。选项将被传递给 postcss-modules                                                                                                                                            |                                                                                  |                                                 |              |        |          |
|              | css.postcss                    | 内联的 PostCSS 配置                                                                                                                                                                                |                                                                                  |                                                 |              |        |          |
|              | css.preprocessorOptions        | 指定传递给 CSS 预处理器的选项。                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | css.devSourcemap               | 在开发过程中是否启用 sourcemap。                                                                                                                                                                   |                                                                                  |                                                 |              |        |          |
|              | json.namedExports              | 是否支持从 .json 文件中进行按名导入。                                                                                                                                                              |                                                                                  | true                                            |              |        |          |
|              | json.stringify                 | 若设置为 true，导入的 JSON 会被转换为 export default JSON.parse(&quot;...&quot;)，这样会比转译成对象字面量性能更好，尤其是当 JSON 文件较大的时候。                                                           |                                                                                  |                                                 |              |        |          |
|              | esbuild                        | 传递给 esbuild 的配置项                                                                                                                                                                            |                                                                                  |                                                 |              |        |          |
|              | assetsInclude                  |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | logLevel                       | 调整控制台输出的级别，默认为 'info'。                                                                                                                                                              |                                                                                  |                                                 | 'info'       | 'warn' | 'error'  | 'silent' |     |     |
|              | clearScreen                    |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | envDir                         | 用于加载 .env 文件的目录                                                                                                                                                                           |                                                                                  |                                                 |              |        |          |
|              | envPrefix                      | 以 envPrefix 开头的环境变量会通过 import.meta.env 暴露在你的客户端源码中。                                                                                                                         |                                                                                  | 'VITE_'                                        |              |        |          |
|              | appType                        |                                                                                                                                                                                                    |                                                                                  |                                                 | 'spa'        | 'mpa'  | 'custom' |          |     |
| 服务器选项   |                                |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | server.host                    | 指定服务器应该监听哪个 IP 地址。                                                                                                                                                                   |                                                                                  | 'localhost'                                     |              |        |          |
|              | server.port                    | 指定开发服务器端口。                                                                                                                                                                               |                                                                                  | 5173                                            |              |        |          |
|              | server.strictPort              | 设为 true 时若端口已被占用则会直接退出，而不是尝试下一个可用端口。                                                                                                                                 |                                                                                  |                                                 |              |        |          |
|              | server.https                   | 启用 TLS + HTTP/2                                                                                                                                                                                  | boolean                                                                          | https.ServerOptions                             |              |        |          |          |
|              | server.open                    | 在开发服务器启动时自动在浏览器中打开应用程序。                                                                                                                                                     |                                                                                  |                                                 |              |        |          |
|              | server.proxy                   | 为开发服务器配置自定义代理规则。与 vue2 的代理很像。                                                                                                                                               | { key: options }                                                                 |                                                 |              |        |          |
|              | server.cors                    | 为开发服务器配置 CORS                                                                                                                                                                              | boolean / CorsOptions                                                            | 默认启用并允许任何源                            |              |        |          |
|              | server.headers                 | 指定服务器响应的 header。                                                                                                                                                                          |                                                                                  |                                                 |              |        |          |
|              | server.hmr                     | 禁用或配置 HMR 连接                                                                                                                                                                                |                                                                                  |                                                 |              |        |          |
|              | server.watch                   | 传递给 chokidar 的文件系统监听器选项。                                                                                                                                                             |                                                                                  |                                                 |              |        |          |
|              | server.middlewareMode          | 以中间件模式创建 Vite 服务器。（不含 HTTP 服务器）                                                                                                                                                 |                                                                                  |                                                 | 'ssr'        | 'html' |          |          |
|              | server.base                    | 在 HTTP 请求中预留此文件夹，用于代理 Vite 作为子文件夹时使用。应该以 / 字符开始和结束。                                                                                                            |                                                                                  |                                                 |              |        |          |
|              | server.fs.strict               | 限制为工作区 root 路径以外的文件的访问。                                                                                                                                                           |                                                                                  |                                                 |              |        |          |
|              | server.fs.allow                | 限制哪些文件可以通过 /@fs/ 路径提供服务。当 server.fs.strict 设置为 true 时，访问这个目录列表外的文件将会返回 403 结果。                                                                           |                                                                                  |                                                 |              |        |          |
|              | server.fs.deny                 | 用于限制 Vite 开发服务器提供敏感文件的黑名单。                                                                                                                                                     |                                                                                  | ['.env', '.env.<em>', '</em>.{pem,crt}']               |              |        |          |
|              | server.origin                  | 用于定义开发调试阶段生成资产的 origin。                                                                                                                                                            |                                                                                  |                                                 |              |        |          |
| 构建选项     |                                | 与服务器选项差不多                                                                                                                                                                                 |                                                                                  |                                                 |              |        |          |
|              | build.target                   | 设置最终构建的浏览器兼容目标。                                                                                                                                                                     |                                                                                  | 'modules'                                       |              |        |          |
|              | build.polyfillModulePreload    | 用于决定是否自动注入 module preload 的 polyfill.                                                                                                                                                   |                                                                                  |                                                 |              |        |          |
|              | build.outDir                   | 指定输出路径（相对于 项目根目录).                                                                                                                                                                  |                                                                                  |                                                 |              |        |          |
|              | build.assetsDir                | 指定生成静态资源的存放路径（相对于 build.outDir）。                                                                                                                                                |                                                                                  |                                                 |              |        |          |
|              | build.assetsInlineLimit        | 小于此阈值的导入或引用资源将内联为 base64 编码，                                                                                                                                                   |                                                                                  |                                                 |              |        |          |
|              | build.cssCodeSplit             | 启用/禁用 CSS 代码拆分。                                                                                                                                                                           |                                                                                  |                                                 |              |        |          |
|              | build.cssTarget                | 此选项允许用户为 CSS 的压缩设置一个不同的浏览器 target，                                                                                                                                           |                                                                                  |                                                 |              |        |          |
|              | build.sourcemap                | 构建后是否生成 source map 文件                                                                                                                                                                     |                                                                                  |                                                 |              |        |          |
|              | build.rollupOptions            | 自定义底层的 Rollup 打包配置。                                                                                                                                                                     |                                                                                  |                                                 |              |        |          |
|              | build.commonjsOptions          | 传递给 @rollup/plugin-commonjs 插件的选项。                                                                                                                                                        | 这都要用一个配置项。要是再多几个插件，是不是会再多几个配置项呀。vue 团队真是神坑 |                                                 |              |        |          |
|              | build.dynamicImportVarsOptions | 传递给 @rollup/plugin-dynamic-import-vars 的选项。                                                                                                                                                 |                                                                                  |                                                 |              |        |          |
|              | build.lib                      | 构建为库                                                                                                                                                                                           |                                                                                  |                                                 |              |        |          |
|              | build.manifest                 | 当设置为 true，构建后将会生成 manifest.json 文件，                                                                                                                                                 |                                                                                  |                                                 |              |        |          |
|              | build.ssrManifest              | 构建也将生成 SSR 的 manifest 文件，                                                                                                                                                                |                                                                                  |                                                 |              |        |          |
|              | build.ssr                      | 生成面向 SSR 的构建                                                                                                                                                                                |                                                                                  |                                                 |              |        |          |
|              | build.minify                   | 设置为 false 可以禁用最小化混淆                                                                                                                                                                    | boolean 、 'terser' 、 'esbuild'                                                 | 'esbuild'                                       |              |        |          |
|              | build.terserOptions            | 传递给 Terser 的更多 minify 选项。                                                                                                                                                                 |                                                                                  |                                                 |              |        |          |
|              | build.write                    | 设置为 false 来禁用将构建后的文件写入磁盘。                                                                                                                                                        |                                                                                  |                                                 |              |        |          |
|              | build.emptyOutDir              |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | build.reportCompressedSize     | 启用/禁用 gzip 压缩大小报告。                                                                                                                                                                      | boolean                                                                          | true                                            |              |        |          |
|              | build.chunkSizeWarningLimit    | 规定触发警告的 chunk 大小。(kbs)                                                                                                                                                                   | number                                                                           | 500                                             |              |        |          |
|              | build.watch                    |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
| 预览选项     | 与上面的差不多                 |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.host                   |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.port                   |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.strictPort             |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.https                  |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.open                   |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.proxy                  |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | preview.cors                   |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
| 依赖优先选项 |                                |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | optimizeDeps.entries           | 默认情况下，Vite 会抓取你的 index.html 来检测需要预构建的依赖项（忽略了 node_modules、build.outDir、<code>__tests__</code> 和 coverage）。如果指定了 build.rollupOptions.input，Vite 将转而去抓取这些入口点。 |                                                                                  |                                                 |              |        |          |
|              | optimizeDeps.exclude           | 在预构建中强制排除的依赖项。                                                                                                                                                                       |                                                                                  |                                                 |              |        |          |
|              | optimizeDeps.include           | 使用此选项可强制预构建链接的包。                                                                                                                                                                   | string[]                                                                         |                                                 |              |        |          |
|              | optimizeDeps.esbuildOptions    | 在部署扫描和优化过程中传递给 esbuild 的选项。                                                                                                                                                      |                                                                                  |                                                 |              |        |          |
|              | optimizeDeps.force             | 设置为 true 可以强制依赖预构建，而忽略之前已经缓存过的、已经优化过的依赖。                                                                                                                         |                                                                                  |                                                 |              |        |          |
| ssr 选项     |                                |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | ssr.external                   | 要为 SSR 强制外部化的依赖。                                                                                                                                                                        |                                                                                  |                                                 |              |        |          |
|              | ssr.noExternal                 | 列出的是防止被 SSR 外部化依赖项。                                                                                                                                                                  |                                                                                  |                                                 |              |        |          |
|              | ssr.target                     | SSR 服务器的构建目标。                                                                                                                                                                             | 'node' / 'webworker'                                                             | 'node'                                          |              |        |          |
|              | ssr.format                     | SSR 服务器的构建语法格式。                                                                                                                                                                         | 'esm' / 'cjs'                                                                    | 'esm'                                           |              |        |          |
| worker 选项  |                                |                                                                                                                                                                                                    |                                                                                  |                                                 |              |        |          |
|              | worker.format                  | worker 打包时的输出类型。                                                                                                                                                                          | 'es' / 'iife'                                                                    | 'iife'                                          |              |        |          |
|              | worker.plugins                 | 应用于 worker 打包的 Vite 插件。                                                                                                                                                                   |                                                                                  |                                                 |              |        |          |
|              | worker.rollupOptions           | 用于打包 worker 的 Rollup 配置项。                                                                                                                                                                 |                                                                                  |                                                 |              |        |          |</p>
<h2 id="title">title</h2>
<h2 id="title-1">title</h2>
<h2 id="title-2">title</h2>
<h2 id="title-3">title</h2>
<h2 id="api"><a href="/builder/vite/api.html">api</a></h2>
<h2 id="principle">principle</h2>
<p>基于 esbuil/rollup 开发的。</p>
<h3 id="uml">uml</h3>
<pre><code>
</code></pre>
<h2 id="todo">todo</h2>
<blockquote>
<p>服务端使用 cjs 规范，vite 使用 esm 规范。vite 是如何提供服务能力的？
官方文档写的太烂了。
如果一个项目需要维护 4-5 以上。不要用 vue，用 react。vue 的迭代变化太大。vue 的迭代问题，react 都没有。
vue1 =&gt; vue2 =&gt; vue3 一次比一次变化大。从 1 到 2 还有一个一完全迁移工具。从 2 到 3 完全是重构。
vue 团队急于求成。为了抢占市场，推出不完成产品。后期迭代变化巨大。好多 api 改变了用法。
如何才能做到写好文档
写好项目（如：结构化）</p>
</blockquote>
<pre><code>按功能模块写基本使用文档。说清如何使用基本功能。
再整理一个完整api
再聊一下运行逻辑、源码。
如何扩展、做插件
</code></pre>
<blockquote>
<p>我不喜欢这个项目。
vue 团队就喜欢搞些方便使用的畸型代码。把 data/methods 都放在 vm 上。把 VITE_开头的变量放在 import.meta.env 上。<br>
vite 自己做了什么？esbuild 做了什么？
未来迭代计划。
未来迭代计划。</p>
</blockquote>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>